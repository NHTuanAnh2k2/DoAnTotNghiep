<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<nav th:replace="~{/layoutadmin/head.html}"></nav>
<style>
    .checkbox-red:checked {
        background-color: red;
    }

    /* CSS cho tab */
    .tab {
        display: none;
        /* Ẩn tất cả các tab khi ban đầu */
    }

    /* Định dạng các tab */
    .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        position: relative;
        /* Đặt vị trí của nút xóa */
    }

    /* Tạo nội dung của mỗi tab */
    .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
    }

    /* Biểu tượng xóa */
    .close {
        position: absolute;
        top: 0;
        right: 0;
        color: red;
        /* Màu của biểu tượng xóa */
        font-size: 20px;
        cursor: pointer;
        display: none;
        /* Ẩn ban đầu */
    }

    /* Hiển thị biểu tượng xóa khi rê chuột vào tab */
    .tab button:hover .close {
        display: block;
    }

    /* CSS cho tab được chọn */
    .tab button.active {
        border-bottom: 2px solid red;
        /* Đường viền dưới màu đỏ cho tab khi được chọn */
    }


    /* css cho modal mã giảm giá */


    .ma_giam_gia {
        width: 100%;
        margin-bottom: 15px;
        padding: 5px 10px;
        background: #fff;
        display: flex;
        border-radius: 15px;
    }

    .ma-item-left {
        width: 30%;
        padding-right: 10px;
        display: flex;
        align-items: center;
        border-right: 1px dashed #ccc;
    }

    .anh_ma {
        width: auto;
        height: auto;
        max-width: 100%;
    }

    .ma-item-right {
        padding-left: 10px;
        position: relative;
        width: 70%;
    }

    .ma-item-des {
        display: flex;
        justify-content: space-between;
        align-items: self-end;
        font-size: 10px;
    }

    .right_magiam {
        font-weight: 700;
        padding: 5px 7px;
        background: rgb(249, 72, 42);
        color: white;
        border-radius: 15px;
        cursor: pointer;
        margin-bottom: 26px;
    }

    .right_magiam:hover {
        font-weight: 700;
        padding: 5px 7px;
        background: rgb(249, 72, 42);
        color: white;
        border-radius: 15px;
        cursor: pointer;
        margin-bottom: 26px;
        border: 0.5px solid rgb(77, 70, 70);
        /* Hiển thị viền khi hover */
        transform: scale(1.01);
        /* Tăng kích thước một chút khi hover */
    }

    .image-container {
        position: relative;
        display: inline-block;
    }

    .discount-badge {
        position: absolute;
        top: 2px;
        /* Khoảng cách từ phía trên */
        right: 2px;
        /* Khoảng cách từ bên phải */
        background-color: red;
        color: white;
        padding: 5px;
        border-radius: 50%;
        /* Làm cho hình dạng của badge thành hình tròn */
        font-size: 12px;
        font-weight: bold;
    }

    .strikethrough {
        position: relative;
        display: inline-block;
    }

    .strikethrough::before {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        top: 50%;
        /* Điều chỉnh vị trí của gạch ngang */
        border-top: 2px solid rgb(29, 3, 3);
        /* Đặt màu và độ dày của gạch ngang */
        transform: translateY(-50%);
        /* Canh chỉnh đường gạch ngang giữa chữ */
        z-index: 1;
        /* Đảm bảo gạch ngang nằm trên chữ */
    }
</style>
<script src="../sweetalert2/dist/sweetalert2.min.js/"></script>
<link rel="stylesheet" type="text/css" href="../sweetalert2/dist/sweetalert2.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<body class="hold-transition sidebar-mini" style="font-family: 'Bahnschrift'">

    <div class="wrapper">
        <!-- Navbar -->
        <nav th:replace="~{/layoutadmin/navbar.html}"></nav>
        <!-- End navbar -->

        <!--Menu bán hàng -->
        <nav th:replace="~{/layoutadmin/menu.html}"></nav>
        <!--end-->


        <!--Nội dung2 -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <!-- Content Header (Page header) -->


            <section class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1>
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                    class="bi bi-bookmark-dash-fill" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5M6 6a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1z" />
                                </svg>
                                BÁN HÀNG TẠI QUẦY

                            </h1>
                            <div id="dataContainer" th:data-my-attribute="${check}" style="display:none;"></div>
                        </div>
                        <!--                    <div class="col-sm-6">-->
                        <!--                        <ol class="breadcrumb float-sm-right">-->
                        <!--                            <li class="breadcrumb-item"><a href="#">Home</a></li>-->
                        <!--                            <li class="breadcrumb-item active">BÁN HÀNG TẠI QUẦY</li>-->
                        <!--                        </ol>-->
                        <!--                    </div>-->
                    </div>
                </div><!-- /.container-fluid -->
            </section>
            <!-- Nút để tạo hóa đơn -->
            <div class="d-flex justify-content-end pe-2">
                <button class="btn" style="background-color: rgb(249,72,42);color: white" onclick="taoNewHD()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        class="bi bi-plus" viewBox="0 0 16 16">
                        <path
                            d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                    </svg>
                    Tạo hóa đơn
                </button>
                <button onclick="showHDtrangcho()" type="button" class="btn btn-outline-dark" style="margin-left: 10px;"
                    data-bs-toggle="modal" data-bs-target="#trancho">Hóa đơn hàng chờ <i
                        class="bi bi-hourglass-split"></i></button>
            </div>
            <p></p>
            <!-- Container cho các tab -->
            <div class="tab" id="tabContainer">
                <!-- Các tab sẽ được tạo ra bởi JavaScript -->
            </div>
            <div class="d-flex">
                <h5 style="margin-left: 25px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        class="bi bi-bucket" viewBox="0 0 16 16">
                        <path
                            d="M2.522 5H2a.5.5 0 0 0-.494.574l1.372 9.149A1.5 1.5 0 0 0 4.36 16h7.278a1.5 1.5 0 0 0 1.483-1.277l1.373-9.149A.5.5 0 0 0 14 5h-.522A5.5 5.5 0 0 0 2.522 5m1.005 0a4.5 4.5 0 0 1 8.945 0zm9.892 1-1.286 8.574a.5.5 0 0 1-.494.426H4.36a.5.5 0 0 1-.494-.426L2.58 6h10.838z" />
                    </svg>
                    Sản phẩm
                </h5>
                <button class="btn btn-dark" style="margin-left: 535px" id="start-scan">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        class="bi bi-qr-code-scan" viewBox="0 0 16 16">
                        <path
                            d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z" />
                        <path d="M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z" />
                        <path d="M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z" />
                        <path
                            d="M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z" />
                        <path d="M12 9h2V8h-2z" />
                    </svg>
                    Quét QR Sản phẩm
                </button>
                <button class="btn" style="margin-left: 20px;background-color: rgb(249,72,42);color: white"
                    data-bs-toggle="modal" data-bs-target="#modalThemSanPhamHD" id="changeSP">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        class="bi bi-plus" viewBox="0 0 16 16">
                        <path
                            d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                    </svg>
                    Thêm sản phẩm
                </button>
                <a href="http://localhost:8080/hoa-don/hien-thi">
                    <button class="btn" style="margin-left: 20px;background-color: rgb(220, 67, 40);color: white">
                        <i class="bi bi-list-ol"></i>
                        Danh sách hóa đơn
                    </button>
                </a>

            </div>
            <hr <!-- Nội dung của các tab -->
            <div id="GhiDeTab">
                <div class="tab-pane fade show active text-center fw-bold" id="tatCaHoaDon-tab-pane" role="tabpanel"
                    aria-labelledby="tatCaHoaDon-tab" tabindex="0">
                    <br>
                    <img src="../dist/img/no_product.png" width="500px" height="300px">
                    <h3 class="text text-danger"><i>Chưa có hóa đơn nào được tạo!! <i class="bi bi-emoji-tear"></i>!</i>
                    </h3>
                </div>
            </div>
            <!-- các modal -->
            <!-- modal qr -->
            <div class="modal fade" id="qrModal" tabindex="-1" aria-labelledby="qrModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="qrModalLabel"></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div style="display: flex; justify-content: center;">
                                <video id="video" width="100%" height="100%" style="border: 1px solid gray"></video>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- modal tràn chờ -->
            <div class="modal fade" id="trancho" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
                aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="staticBackdropLabel">Thông tin hàng chờ</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="d-flex justify-content-between">
                                <div style="border-right: 1px solid #ccc;" class="col-6">
                                    <div class="d-flex justify-content-center"
                                        style="border-bottom: 1px solid #ccc; margin-bottom: 4px;">
                                        <h5>Đơn trong hàng chờ</h5>
                                    </div>
                                    <div id="name-checkbox-l">

                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="d-flex justify-content-center"
                                        style="border-bottom: 1px solid #ccc; margin-bottom: 4px;">
                                        <h5>Đơn đang xử lý</h5>
                                    </div>
                                    <div id="name-checkbox-r">


                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>
                            <button type="button" class="btn btn-primary" id="btnChuyen"
                                onclick="chuyendoiTranCho()">Chuyển đổi</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--         
    thay đổi thông tin hóa đơn -->
            <div class="modal fade" id="modalThayDoiHoaDon5" tabindex="-1" aria-labelledby="exampleModalThayDoiHoaDon5"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title fs-5" id="exampleModalThayDoiHoaDon5">Thanh toán hóa đơn: <span
                                    id="hdThanhToanShow"></span></h3>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">

                            <div>
                                Số tiền
                                <input type="text" class="form-control" id="sotienhienthi"
                                    oninput="showcasst('sotienhienthi')">
                            </div>
                            <br>
                            <div class="d-flex">
                                <button class="btn" style="width: 217px;background-color: rgb(249,72,42);color: white"
                                    id="tienmat" onclick="xacnhanphuongthuc(1)">Tiền
                                    mặt</button>
                                <button
                                    style="margin-left: 15px;width: 217px;background-color: rgb(249,72,42);color: white"
                                    id="chuyenkhoan" class="btn" onclick="xacnhanphuongthuc(0)">Chuyển
                                    khoản</button>
                            </div>
                            <br>
                            <table style="width: 100%" class="table-bordered table-hover text-center">
                                <thead style="height: 50px">
                                    <tr>
                                        <th>STT</th>
                                        <th>Mã giao dịch</th>
                                        <th>Số tiền</th>
                                        <th>Phương thức</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody id="showpt">

                                </tbody>
                            </table>
                            <br>
                            <div class="d-flex justify-content-between">
                                <p>
                                    Khách thanh toán
                                </p>
                                <p style="color: #0a53be;font-weight: bold" id="dathanhtoanroi">
                                    0đ
                                </p>
                            </div>
                            <div class="d-flex justify-content-between">
                                <p>
                                    Tiền thiếu
                                </p>
                                <p style="color: red;font-weight: bold" id="tienthieu">
                                    5,500,000đ
                                </p>
                            </div>


                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Hủy</button>
                            <button type="button" class="btn" style="background-color: rgb(249,72,42);color: white"
                                data-bs-dismiss="modal" id="xacnhanPT" onclick="xacnhanPTTT()">Xác nhận</button>

                        </div>
                    </div>
                </div>
            </div>

            <!--Modal thay đổi nhân viên-->
            <!-- Modal -->
            <div class="modal fade" id="modalChuyenNhanVien" tabindex="-1" aria-labelledby="exampleModalChuyenNhanVien"
                aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title fs-5" id="exampleModalChuyenNhanVien">Chọn khách hàng
                            </h3>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>

                                    </div>
                                    <nav class="navbar bg-body-tertiary">
                                        <div class="container-fluid">
                                            <form class="d-flex" role="search">
                                                <input style="width: 400px;" class="form-control me-2" type="search"
                                                    placeholder="Nhập họ tên hoặc số điện thoại..." aria-label="Search"
                                                    id="searchNV">
                                                <button type="button" id="reloadnv" class="btn btn-outline-warning"><i
                                                        class="bi bi-arrow-clockwise"></i></button>
                                            </form>
                                        </div>
                                    </nav>
                                </div>


                                <table class="table table-bordered table-hover text-center">
                                    <thead class="table table-danger">
                                        <tr>
                                            <th>STT</th>
                                            <th>Mã khách hàng</th>
                                            <th>Tên khách hàng</th>
                                            <th>Số điện thoại</th>
                                            <th>Ngày sinh</th>
                                            <th>Giới tính</th>
                                            <th>Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbl_doi_nv">

                                    </tbody>
                                </table>
                                <br>

                                <nav aria-label="Page navigation example" id="navNV">
                                    <ul class="pagination">
                                        <li class="page-item" id="btn_prev_page"><a class="page-link"
                                                id="prevPage">Previous</a>
                                        </li>
                                        <li class="d-flex flex-row page-item" id="numberPage">
                                        </li>
                                        <li class="page-item" id="btn_next_page">
                                            <a class="page-link" id="nextPage">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--Kết thúc modal thay đổi nhân viên-->

            <!-- thêm sản phẩm vào hóa đơn -->

            <!--Modal thêm sản phẩm vào hóa đơn-->
            <!-- Modal -->
            <div class="modal fade" id="modalThemSanPhamHD" tabindex="-1" aria-labelledby="exampleModalThemSanPhamHD"
                aria-hidden="true">
                <div class="modal-dialog modal-xl modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title fs-5" id="exampleModalThemSanPhamHD">Thêm
                                sản phẩm vào đơn hàng</h3>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <nav class="navbar bg-body-tertiary">
                                        <form>
                                            <div class="d-flex align-items-center">
                                                <input class="form-control me-2" type="search" id="tensp"
                                                    placeholder="Nhập tên sản phẩm..." aria-label="Search"
                                                    style="width: 984px;">
                                                <button type="button" id="reloadsp" class="btn btn-outline-warning"><i
                                                        class="bi bi-arrow-clockwise"></i></button>
                                            </div>
                                            <!--Bộ lọc-->
                                            <div class="align-items-center">
                                                <div class="d-flex justify-content-around">
                                                    <div>
                                                        <label class="col-form-label">Chất
                                                            liệu</label>
                                                        <select class="form-select" onchange="SearchSPHDCT()"
                                                            id="chatlieu" style="width: 120px;">
                                                            <option value="all" selected>
                                                                ----</option>
                                                            <option th:each="a:${dsChatLieu}" th:value="${a.ten}"
                                                                th:text="${a.ten}">

                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="col-form-label">Thương
                                                            hiệu</label>
                                                        <select class="form-select" onchange="SearchSPHDCT()"
                                                            id="thuonghieu" style="width: 120px;">
                                                            <option value="all" selected>
                                                                ----</option>
                                                            <option th:each="a:${dsThuongHieu}" th:value="${a.ten}"
                                                                th:text="${a.ten}">

                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="col-form-label">Đế
                                                            giày</label>
                                                        <select class="form-select" onchange="SearchSPHDCT()"
                                                            id="degiay" style="width: 120px;">
                                                            <option value="all" selected>
                                                                ----</option>
                                                            <option th:each="a:${dsDe}" th:value="${a.ten}"
                                                                th:text="${a.ten}">

                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="col-form-label">Kích
                                                            cỡ</label>
                                                        <select class="form-select" onchange="SearchSPHDCT()"
                                                            id="kichco" style="width: 120px;">
                                                            <option value="all" selected>
                                                                ----</option>
                                                            <option th:each="a:${dsKichCo}" th:value="${a.ten}"
                                                                th:text="${a.ten}">

                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="col-form-label">Màu
                                                            sắc</label>
                                                        <select class="form-select" onchange="SearchSPHDCT()"
                                                            id="mausac" style="width: 120px;">
                                                            <option value="all" selected>
                                                                ----</option>
                                                            <option th:each="a:${dsMauSac}" th:value="${a.ten}"
                                                                th:style="'background-color: ' + ${a.ten} + '; color: ' + ${#fff}"
                                                                th:text="${a.ten}">
                                                                <span th:text="${a.ten}"></span>
                                                            </option>
                                                        </select>
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="d-flex justify-content-evenly">
                                                <div>
                                                    <label class="col-form-label">Giới
                                                        tính</label>
                                                    <select class="form-select" onchange="SearchSPHDCT()" id="gioitinh"
                                                        style="width: 120px;">

                                                        <option value="true">Nam</option>
                                                        <option value="false">Nữ</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label class="col-form-label">Khoảng
                                                        giá: <span id="priceRangeValue">500,000 đ
                                                        </span></label>

                                                    <div class="slidecontainer mt-1" style="width: 495px;">
                                                        <input type="range" min="100000" onchange="SearchSPHDCT()"
                                                            max="8000000" value="500000" style="width: 100%;"
                                                            id="priceRange">
                                                    </div>


                                                </div>
                                            </div>
                                        </form>
                                    </nav>
                                </div>
                                <br>
                                <table class="table table-bordered table-hover text-center">
                                    <thead class="table table-danger">
                                        <tr>
                                            <th>STT</th>
                                            <th>Ảnh sản phẩm</th>
                                            <th>Tên sản phẩm</th>
                                            <th>Số lượng</th>
                                            <th>Kích cỡ</th>
                                            <th>Màu sắc</th>
                                            <th>Trạng thái</th>
                                            <th>Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbl_sp_them">

                                    </tbody>
                                </table>
                                <br>
                                <nav aria-label="Page navigation example" id="navAddSPHDCT">
                                    <ul class="pagination">
                                        <li class="page-item" id="btn_prev_page"><a class="page-link"
                                                id="prevPageSP">Previous</a>
                                        </li>
                                        <li class="d-flex flex-row page-item" id="numberPageSP">


                                        </li>
                                        <li class="page-item" id="btn_next_page">
                                            <a class="page-link" id="nextPageSP">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--Kết thúc Modal thêm sản phẩm vào hóa đơn-->
            <!-- modal bill  -->
            <div class="modal fade" id="orderSuccessModal" data-bs-backdrop="static" data-bs-keyboard="false"
                tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">

                        <div class="modal-body">
                            <div id="hienthibill">

                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="inbill()">In
                                hóa đơn</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- thêm khách hàng -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Thêm nhanh khách hàng</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">

                            <form th:action="@{http://localhost:8080/ban-hang-tai-quay/add-nhanh}"
                                th:object="${AddKHNhanh}" method="post">
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập họ và tên" id="TTTK_ten"
                                        th:field="*{ten}">
                                </p>
                                <i style="color: red; size: 1px;" id="TTTK_ten_regex"></i>
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập số điện thoại"
                                        id="TTTK_sdt" th:field="*{sdt}">
                                </p>
                                <i style="color: red;" id="TTTK_sdt_regex"></i>
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập email" id="TTTK_email"
                                        th:field="*{email}">
                                </p>
                                <i style="color: red;" id="TTTK_email_regex"></i>
                                <div class="d-flex">
                                    <div class="col-md-4">
                                        <select class="form-select form-select-sm mb-3" id="city" th:field="*{tinh}">
                                            <option value="chọn tỉnh" th:text="*{tinh}" selected>
                                                Chọn tỉnh thành</option>
                                        </select>
                                        <i style="color: red;" id="TTTK_city_regex"></i>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select form-select-sm mb-3" id="district"
                                            th:field="*{huyen}">
                                            <option value="chọn huyện" th:text="*{huyen}" selected>Chọn quận huyện
                                            </option>
                                        </select>
                                        <i style="color: red;" id="TTTK_district_regex"></i>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select form-select-sm mb-3" id="ward" th:field="*{xa}">
                                            <option value="chọn xã" th:text="*{xa}" selected>
                                                Chọn phường xã</option>
                                        </select>
                                        <i style="color: red;" id="TTTK_ward_regex"></i>
                                    </div>
                                </div>
                                <p>
                                    <textarea class="form-control" placeholder="Số nhà/đường" id="TTTK_diachi"
                                        th:field="*{diachi}"></textarea>
                                </p>
                                <i style="color: red;" id="TTTK_diachi_regex"></i>
                                <div class="d-flex justify-content-start">
                                    <p class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" checked
                                            id="inputThemNhanh" onclick="seton()" th:field="*{check}">
                                    </p>
                                    <div class="ms-3" id="showndcheck">

                                        <p style="font-style: italic;">Thêm nhanh và lựa chọn khách hàng cho hóa đơn!
                                        </p>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <button type="submit" class="btn" onclick="return validateForms()"
                                        style="background-color: rgb(249,72,42);color: white">Thêm nhanh</button>
                                </div>
                            </form>

                        </div>

                    </div>
                </div>
            </div>
            <!--</div>-->
            <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
                aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" style="width: 430px;">
                    <div class="modal-content">
                        <div class="modal-header" style="background-color: #EEEEEE;">
                            <h1 class="modal-title fs-5" id="staticBackdropLabel">Danh sách phiếu khuyến mãi:</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" style="background-color: #e6f2f4;" id="showvoucher">


                        </div>
                    </div>
                </div>
            </div>
            <!--end-->
            <div>
                <hr>
                <div class="d-flex">
                    <h5 style="margin-left: 820px">Tổng tiền:</h5>
                    <h5 style="margin-left: 25px;color: red" id="tongTien">0 đ</h5>
                </div>
                <br>
                <div class="d-flex pe-1 ps-1">
                    <h5 class="me-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                            class="bi bi-person" viewBox="0 0 16 16">
                            <path
                                d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z" />
                        </svg>
                        Tài khoản
                    </h5>
                    <button class="btn ms-auto" style="background-color: rgb(249,72,42);color: white"
                        data-bs-toggle="modal" data-bs-target="#modalChuyenNhanVien" id="changeNV">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                            class="bi bi-plus" viewBox="0 0 16 16">
                            <path
                                d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                        </svg>
                        Chọn tài khoản
                    </button>
                    <button type="button" class="btn ms-1" data-bs-toggle="modal" data-bs-target="#exampleModal"
                        id="themKHS" style="background-color: rgb(42, 197, 249);color: white">+Thêm khách
                        hàng</button>

                </div>
                <hr>
                <div id="thongTinTaiKhoan">

                </div>
                <br>
                <div class="d-flex justify-content-between pe-1 ps-1">
                    <h5>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                            class="bi bi-person" viewBox="0 0 16 16">
                            <path
                                d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z" />
                        </svg>
                        Khách hàng
                    </h5>
                    <p></p>
                </div>
                <hr>
                <div class="row ps-2 pe-2">
                    <div class="col-7">
                        <div style="display: none;" id="diachidiv">
                            <form id="thongtingiaohangform" th:object="${thongtingiaohang}" method="post" action="">
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập họ và tên"
                                        id="thongtingiao_ten" th:field="*{ten}">
                                    <i style="color: red;" id="regexTen"></i>
                                </p>
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập số điện thoại"
                                        id="thongtingiao_sdt" th:field="*{sdt}">
                                    <i style="color: red;" id="regexsdt"></i>
                                </p>
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập email"
                                        id="thongtingiao_email" th:field="*{email}">
                                    <i style="color: red;" id="regexemail"></i>
                                </p>
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập địa chỉ"
                                        id="thongtingiao_diachi" th:field="*{diachi}">
                                    <i style="color: red;" id="regexdiachi"></i>
                                </p>
                                <div class="d-flex">
                                    <div class="col-md-4">
                                        <select class="form-select" id="tinhthanh" th:field="*{tinh}">
                                            <option value="chọn tỉnh" th:text="*{tinh}" selected>
                                                Chọn tỉnh thành</option>
                                        </select>
                                        <i style="color: red;" id="regextinh" class="col-4"></i>

                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select" id="quanhuyen" th:field="*{huyen}">
                                            <option value="chọn huyện" th:text="*{huyen}" selected>Chọn quận huyện
                                            </option>
                                        </select>
                                        <i style="color: red;" id="regexhuyen" class="col-4"></i>

                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select" id="xaphuong" th:field="*{xa}"
                                            onchange="feanddate()">
                                            <option value="chọn xã" th:text="*{xa}" selected>
                                                Chọn phường xã</option>
                                        </select>
                                        <i style="color: red;" id="regexxa" class="col-4"></i>
                                    </div>
                                </div>
                                <p>
                                    <input type="text" class="form-control" placeholder="Phí vận chuyển" readonly
                                        oninput="showcassts('phigiaohang')" id="phigiaohang" th:field="*{phivanchuyen}">
                                    <i style="color: red;" id="regexship"></i>
                                </p>
                                <p>
                                    <textarea class="form-control" placeholder="Ghi chú"
                                        th:field="*{ghichu}"></textarea>
                                </p>
                                <div class="d-flex justify-content-between ms-1">
                                    <p>Trả sau:</p>
                                    <p class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch"
                                            th:field="*{trasau}" onchange="handleCheckboxChange(event)">
                                    </p>
                                </div>
                                <div class="d-flex justify-content-between ms-1">
                                    <p>Hỏa tốc:</p>
                                    <p class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch"
                                            th:field="*{giaohoatoc}" onchange="hoatoc(event)">
                                    </p>
                                </div>
                                <div class="d-flex justify-content-between ms-1">
                                    <p>Ngày giao dự kiến:</p>
                                    <p id="ngaygiaodukiens">
                                        đang tính toán...
                                    </p>
                                    <input type="text" class="form-control" id="thongtingiao_ngaygiao"
                                        th:field="*{ngaygiaodukien}" style="display: none;">
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="col-5">
                        <h5>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                class="bi bi-bucket" viewBox="0 0 16 16">
                                <path
                                    d="M2.522 5H2a.5.5 0 0 0-.494.574l1.372 9.149A1.5 1.5 0 0 0 4.36 16h7.278a1.5 1.5 0 0 0 1.483-1.277l1.373-9.149A.5.5 0 0 0 14 5h-.522A5.5 5.5 0 0 0 2.522 5m1.005 0a4.5 4.5 0 0 1 8.945 0zm9.892 1-1.286 8.574a.5.5 0 0 1-.494.426H4.36a.5.5 0 0 1-.494-.426L2.58 6h10.838z" />
                            </svg>
                            Thông tin thanh toán
                        </h5>
                        <!-- data-bs-toggle="modal" data-bs-target="#modalThayDoiHoaDon5" -->
                        <div class="d-flex justify-content-between">
                            <p style="font-weight: bold">Khách thanh toán:
                                <button class="btn" id="chantrasau" onclick="thanhtoan()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                        class="bi bi-credit-card" viewBox="0 0 16 16">
                                        <path
                                            d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v1h14V4a1 1 0 0 0-1-1zm13 4H1v5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z" />
                                        <path
                                            d="M2 10a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z" />
                                    </svg>
                                </button>
                            </p>
                            <p></p>
                        </div>
                        <div class="d-flex justify-content-between mb-1">

                            <p style="font-weight: bold; margin-top: 10px;"> Mã giảm giá:</p>
                            <!-- <p style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white; padding-top: 10px;"
                                id="maGiamFill">Chưa có mã giảm phù hợp!</p> -->

                            <span class="applied-reduction-code"
                                style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; padding: 3px 15px 3px 15px; padding-top: 10px;">
                                <svg width="16" height="15" xmlns="http://www.w3.org/2000/svg"
                                    class="applied-reduction-code-icon" fill="#CE4549">
                                    <path
                                        d="M14.476 0H8.76c-.404 0-.792.15-1.078.42L.446 7.207c-.595.558-.595 1.463 0 2.022l5.703 5.35c.296.28.687.42 1.076.42.39 0 .78-.14 1.077-.418l7.25-6.79c.286-.268.447-.632.447-1.01V1.43C16 .64 15.318 0 14.476 0zm-2.62 5.77c-.944 0-1.713-.777-1.713-1.732 0-.954.77-1.73 1.714-1.73.945 0 1.714.776 1.714 1.73 0 .955-.768 1.73-1.713 1.73z">
                                    </path>
                                </svg>
                                <span class="applied-reduction-code-information" id="maGiamFill"
                                    style="background-color: #D3D3D3;">Chưa có mã giảm phù hợp!</span>
                            </span>

                            <button class="btn btn-light" style="margin-bottom: 20px;" data-bs-toggle="modal"
                                id="chonMaGiam" data-bs-target="#staticBackdrop" onclick="showmagiam()">
                                Chọn mã giảm</button>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p style="font-weight: bold">Giao hàng:</p>
                            <p class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" onclick="giaohang(event)"
                                    id="checktrasau">
                            </p>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p style="font-weight: bold">Tiền hàng:</p>
                            <p style="font-weight: bold" id="tongTienTTTT"></p>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p style="font-weight: bold">Giảm giá:</p>
                            <p style="font-weight: bold" id="giamgia">0 đ</p>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between">
                            <p style="font-weight: bold">Tổng thanh toán (<span style="color: red">chưa bao gồm phí vận
                                    chuyển</span>):</p>
                            <p style="color: red;font-weight: bold" id="tongThanhToan">0 đ</p>
                        </div>

                        <p>
                            <button style="margin-left: 332px" class="btn btn-dark" disabled id="xacnhanthanhtoanhoadon"
                                onclick="handleLinkClick()">Xác nhận thanh toán</button>
                        </p>

                    </div>

                </div>
            </div>
        </div>

    </div>

    <nav th:replace="~{/layoutadmin/footer.html}"></nav>
    <!--script-->
    <nav th:replace="~{/layoutadmin/script.html}"></nav>
    <!--nội dung 2-->


    <script>
        //tạo biến toàn cũng để sử dụng
        var shipToanCuc = 0;// tiền ship toàn cục
        var tongTienDon;//tổng cả đơn chưa có mã
        var TienGiamDon;//tổng tiền giảm
        var tienkhachthanhtoan;//tổng đã có mã
        var hdHienTai;
        // JavaScript để tạo tab mới
        const urlPage = `/ban-hang-tai-quay/hoa-don-cho`;
        fetch(urlPage)
            .then(function (a) {
                return a.json();
            })
            .then(function (b) {
                if (b.length > 0) {
                    var htmlDiv = '';
                    for (const hd of b) {
                        loadTab(hd.mahoadon);
                        htmlDiv += `
                        <div id="${hd.mahoadon}" class="tabcontent">

                        </div>`;
                    }
                    document.getElementById('GhiDeTab').innerHTML = htmlDiv;
                    openInvoice1(event, b[0].mahoadon);
                } else {

                }

            })

        // JavaScript để mở tab lúc load
        function openInvoice1(evt, invoiceName) {
            shipToanCuc = 0;
            document.getElementById('chonMaGiam').disabled = false;
            document.getElementById('changeNV').disabled = false;
            document.getElementById('start-scan').disabled = false;
            document.getElementById('themKHS').disabled = false;
            document.getElementById('changeSP').disabled = false;
            document.getElementById('tienmat').disabled = false;
            document.getElementById('chuyenkhoan').disabled = false;
            document.getElementById('diachidiv').style.display = 'none';
            document.getElementById("checktrasau").checked = false;
            var i, tabcontent, tablinks;

            // Ẩn tất cả các tabcontent trước khi hiển thị tab được chọn
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Loại bỏ class "active" từ tất cả các tablinks
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active"); // Loại bỏ lớp "active" từ tất cả các tab
            }
            //tạo mã html cho hóa đơn được gọi
            const maHD = invoiceName;
            const urlGetListSP = `/ban-hang-tai-quay/tim-coutSP-theoHD?maHD=${maHD}`;
            fetch(urlGetListSP)
                .then(function (a) {
                    return a.json();
                })
                .then(async function (b) {
                    var tongTien = 0;
                    var tongThanhT = 0;
                    var tienGiamT = 0;
                    var html = '';
                    var htmlTR = '';
                    var htmlMaGiam = '';

                    var urltimHD = `/ban-hang-tai-quay/tim-HD-TheoMaHD?maHD=${invoiceName}`;
                    fetch(urltimHD)
                        .then(function (a) {
                            return a.json();
                        })
                        .then(function (b) {
                            var htmlTTTK = '';
                            if (b.khachhang == null) {
                                htmlTTTK = `
                <div class="d-flex">
            <p style="margin-left: 20px">Tên khách hàng:</p>
            <p style="margin-left: 20px">Khách lẻ</p>
        </div>
                `;
                            } else {

                                htmlTTTK = `
                    <div class="d-flex">
            <p style="margin-left: 20px">Tên khách hàng:</p>
            <p style="margin-left: 20px">${b.khachhang.nguoidung.hovaten}</p>
        </div>
        <div class="d-flex">
            <p style="margin-left: 20px">Số điện thoại:</p>
            <p style="margin-left: 20px">${b.khachhang.nguoidung.sodienthoai}</p>
        </div>
        <div class="d-flex">
            <p style="margin-left: 20px">Email:</p>
            <p style="margin-left: 20px">${b.khachhang.nguoidung.email}</p>
        </div>
                    `;
                            }

                            document.getElementById("thongTinTaiKhoan").innerHTML = htmlTTTK;
                        })


                    if (b.length < 1) {
                        html = `
<div class="tab-pane fade show active text-center fw-bold"
                                id="tatCaHoaDon-tab-pane" role="tabpanel" aria-labelledby="tatCaHoaDon-tab"
                                tabindex="0">
                                <br>
                                <img src="../dist/img/no_product.png" width="500px" height="300px">
                                <h3 class="text text-danger"><i>Danh sách sản phẩm hiện đang trống!! <i
                                            class="bi bi-emoji-tear"></i>!</i></h3>
                            </div>`;
                    }
                    if (b.length > 0) {
                        var discounts;
                        var stt = 0;
                        for (const hd of b) {
                            const urlDiscount = `http://localhost:8080/ban-hang-tai-quay/discounts/${hd.sanphamchitiet.id}`;
                            await fetch(urlDiscount)
                                .then(function (c) {
                                    return c.json();
                                })
                                .then(function (b) {
                                    discounts = b;
                                })
                            if (discounts > 0) {
                                tongTien += hd.soluong * (hd.giasanpham / 100 * (100 - discounts));
                            } else {
                                tongTien += hd.soluong * hd.giasanpham;
                            }

                            stt++;
                            htmlTR += `
                <tr>
<td class="text-center" style="vertical-align: middle;">
    <span style="margin-left: 7px">${stt}</span>
</td>
                   <td>
                   <div class="image-container">
                       <img src="${hd.sanphamchitiet.anh[0].tenanh}" alt="" style="height: 100px; width: 100px;">
                       ${discounts > 0 ? `<div class="discount-badge">${discounts}%</div>` : ''}
                   </div>
               </td>
<td style="vertical-align: middle;">
    <p style="font-weight: bold">${hd.sanphamchitiet.sanpham.tensanpham}</p>
     ${discounts > 0 ? ` <p style="color: red;font-weight: bold">${(hd.giasanpham / 100 * (100 - discounts)).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</p>
      <p class="strikethrough" style="color: black;font-weight: bold">${hd.giasanpham.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</p>
     ` : ` <p style="color: red;font-weight: bold">${hd.giasanpham.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</p>`}
    <p> Size: ${hd.sanphamchitiet.kichco.ten}</p>
</td>
<td style="vertical-align: middle;">
    <input class="form-control" style="width: 120px;height: 30px; margin-left: 20%;" type="text" id="${hd.id}" value="${hd.soluong}" oninput="changeQuantity(event)" name="${hd.sanphamchitiet.id}">
</td>
 <td style="color: red;font-weight: bold;vertical-align: middle;">
                ${discounts > 0 ? ` <p style="color: red;font-weight: bold">${((hd.giasanpham / 100 * (100 - discounts)) * hd.soluong).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</p>
     ` : ` <p style="color: red;font-weight: bold">${(hd.soluong * hd.giasanpham).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</p>`}
           
                </td>

<td style="vertical-align: middle;">
                                               <a href="http://localhost:8080/ban-hang-tai-quay/delete/${hd.id}"
                                                >
                                                <button class="btn btn-outline-danger"
                                                    onclick="return confirm('Bạn có muốn xóa sản phẩm này không?')"
                                                    type="button"><i class="bi bi-trash3"></i></button></a>


                                                    <a href="http://localhost:8080/ban-hang-tai-quay/update/${hd.id}/${hd.soluong}" id="${hd.id + 'fsport'}"
                                                >
                                                <button class="btn btn-outline-warning"
                                                    onclick="return confirm('Bạn có muốn cập nhật lại sản phẩm này không?')"
                                                    type="button"><i
                                                        class="bi bi-arrow-clockwise bi-warning"></i></button></a>
</td>
</tr>
                `;
                        }

                        html = `
<div class="tab-pane fade show active text-center fw-bold"
id="tatCaHoaDon-tab-pane" role="tabpanel" aria-labelledby="tatCaHoaDon-tab"
tabindex="0">
<table style="width: 100%" class="table">
<thead style="height: 50px">
<tr>
<th>STT</th>
<th>Ảnh</th>
<th>Sản phẩm</th>
<th>Số lượng</th>
<th>Tổng tiền</th>
<th>Thao tác</th>
</tr>
</thead>
<tbody id="boddydssp">`+ htmlTR + `

</tbody>
</table>
</div>`;
                    }

                    fetch(`http://localhost:8080/ban-hang-tai-quay/fillMaGiam`)
                        .then(function (a) {
                            return a.json();
                        })
                        .then(function (b) {
                            var b2 = b;
                            if (b.phieugiamgia.id != null) {
                                if (b2.phieugiamgia.loaiphieu == true) {
                                    // phiếu %
                                    if (b2.phieugiamgia.giatrigiam * (tongTien / 100) > b2.phieugiamgia.giatrigiamtoida) {
                                        tienGiamT = b2.phieugiamgia.giatrigiamtoida;
                                    } else {
                                        tienGiamT = b2.phieugiamgia.giatrigiam * (tongTien / 100);
                                    }

                                } else {
                                    // phiếu vnđ
                                    tienGiamT = b2.phieugiamgia.giatrigiam;
                                }
                                tongThanhT = tongTien - tienGiamT;
                                TienGiamDon = tienGiamT;
                                document.getElementById('maGiamFill').innerHTML = b.phieugiamgia.macode;
                            } else {
                                document.getElementById('maGiamFill').innerHTML = 'chưa có mã nào phù hợp!';
                                tongThanhT = tongTien;
                            }
                            tongTienDon = tongTien;
                            tienkhachthanhtoan = tongThanhT;
                            TienGiamDon = tienGiamT;
                            hdHienTai = maHD;


                            document.getElementById('giamgia').innerHTML = tienGiamT.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('tongThanhToan').innerHTML = tongThanhT.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });

                        })
                    document.getElementById('GhiDeTab').innerHTML = html;

                    //document.getElementById(invoiceName).innerHTML = html;
                    document.getElementById("tongTien").innerHTML = tongTien.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                    document.getElementById("tongTienTTTT").innerHTML = tongTien.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });

                })


            // Hiển thị nội dung của tab được chọn và thêm class "active" cho tab đó

            document.getElementById(invoiceName).style.display = "block";

        }

        //load tab
        function loadTab(inputs) {

            var tabContainer = document.getElementById("tabContainer");
            tabContainer.style.display = "inline-block"; // Hiển thị các tab khi nhấn vào nút "Tạo Hóa đơn"

            var tabId = inputs;

            var button = document.createElement("button");
            button.className = "tablinks";
            button.textContent = "Hóa đơn: " + inputs;
            button.setAttribute("data-tab", tabId); // Thêm thuộc tính dữ liệu để liên kết tab với nội dung của nó
            button.setAttribute("onclick", "openInvoice(event, '" + tabId + "')");

            // Tạo biểu tượng xóa
            var closeIcon = document.createElement("span");
            closeIcon.innerHTML = "&times;"; // Thêm biểu tượng xóa (dấu x)
            closeIcon.className = "close";
            closeIcon.setAttribute("onclick", "closeTab('" + tabId + "')"); // Gọi hàm closeTab khi được nhấn
            button.id = tabId;
            button.appendChild(closeIcon); // Thêm biểu tượng xóa vào tab

            tabContainer.appendChild(button);
        }

        //tạo hóa đơn mới
        function taoNewHD() {
            var urlPage = `/ban-hang-tai-quay/hoa-don-cho`;
            fetch(urlPage)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    if (b.length == 5) {
                        var rslt = confirm("Nếu tạo hóa đơn mới bạn sẽ xác nhận chuyển hóa đơn gần nhất về hàng chờ?");
                        if (rslt) {
                            //check hóa đơn hàng chờ
                            var urlChuyenCho = `/ban-hang-tai-quay/chuyen-hang-cho`;
                            fetch(urlChuyenCho)
                                .then(function (a) {
                                    return a.json();
                                })
                                .then(function (b) {

                                    if (b == true) {
                                        var urlTaos = `/ban-hang-tai-quay/tao-don-cho`;
                                        fetch(urlTaos)
                                            .then(function (a) {
                                                return a.json();
                                            })
                                            .then(function (b) {

                                                document.getElementById("tabContainer").innerHTML = '';
                                                for (const hd of b) {
                                                    loadTab(hd.mahoadon);

                                                }
                                                thongbao('01 đơn hàng đã chuyển về hàng tràn chờ', 'success')
                                            })

                                    } else {
                                        showToast();
                                    }

                                })

                        }
                    } else {
                        var urlTao = `/ban-hang-tai-quay/tao-don-cho`;
                        fetch(urlTao)
                            .then(function (a) {
                                return a.json();
                            })
                            .then(function (b) {

                                document.getElementById("tabContainer").innerHTML = '';
                                for (const hd of b) {
                                    loadTab(hd.mahoadon);

                                }


                            })

                    }
                })
        }



        // JavaScript để mở tab
        function openInvoice(evt, invoiceName) {
            shipToanCuc = 0;
            document.getElementById('ngaygiaodukiens').innerHTML = "đang tính toán...";
            document.getElementById('changeNV').disabled = false;
            document.getElementById('chonMaGiam').disabled = false;
            document.getElementById('start-scan').disabled = false;
            document.getElementById('themKHS').disabled = false;
            document.getElementById('changeSP').disabled = false;
            document.getElementById('tienmat').disabled = false;
            document.getElementById('chuyenkhoan').disabled = false;
            document.getElementById('diachidiv').style.display = 'none';
            document.getElementById("checktrasau").checked = false;
            var i, tabcontent, tablinks;

            // Ẩn tất cả các tabcontent trước khi hiển thị tab được chọn
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Loại bỏ class "active" từ tất cả các tablinks
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active"); // Loại bỏ lớp "active" từ tất cả các tab
            }
            evt.currentTarget.classList.add("active"); // Thêm lớp "active" cho tab được chọn


            //tạo mã html cho hóa đơn được gọi
            const maHD = invoiceName;
            const urlGetListSP = `/ban-hang-tai-quay/tim-coutSP-theoHD?maHD=${maHD}`;
            fetch(urlGetListSP)
                .then(function (a) {
                    return a.json();
                })
                .then(async function (b) {
                    var tongTien = 0;
                    var tongThanhT = 0;
                    var tienGiamT = 0;
                    var html = '';
                    var htmlTR = '';
                    var htmlMaGiam = '';

                    var urltimHD = `/ban-hang-tai-quay/tim-HD-TheoMaHD?maHD=${invoiceName}`;
                    fetch(urltimHD)
                        .then(function (a) {
                            return a.json();
                        })
                        .then(function (b) {
                            var htmlTTTK = '';
                            if (b.khachhang == null) {
                                htmlTTTK = `
                            <div class="d-flex">
                        <p style="margin-left: 20px">Tên khách hàng:</p>
                        <p style="margin-left: 20px">Khách lẻ</p>
                    </div>
                            `;
                            } else {

                                htmlTTTK = `
                                <div class="d-flex">
                        <p style="margin-left: 20px">Tên khách hàng:</p>
                        <p style="margin-left: 20px">${b.khachhang.nguoidung.hovaten}</p>
                    </div>
                    <div class="d-flex">
                        <p style="margin-left: 20px">Số điện thoại:</p>
                        <p style="margin-left: 20px">${b.khachhang.nguoidung.sodienthoai}</p>
                    </div>
                    <div class="d-flex">
                        <p style="margin-left: 20px">Email:</p>
                        <p style="margin-left: 20px">${b.khachhang.nguoidung.email}</p>
                    </div>
                                `;
                            }

                            document.getElementById("thongTinTaiKhoan").innerHTML = htmlTTTK;
                        })


                    if (b.length < 1) {
                        html = `
<div class="tab-pane fade show active text-center fw-bold"
                                            id="tatCaHoaDon-tab-pane" role="tabpanel" aria-labelledby="tatCaHoaDon-tab"
                                            tabindex="0">
                                            <br>
                                            <img src="../dist/img/no_product.png" width="500px" height="300px">
                                            <h3 class="text text-danger"><i>Danh sách sản phẩm hiện đang trống!! <i
                                                        class="bi bi-emoji-tear"></i>!</i></h3>
                                        </div>`;
                    }
                    if (b.length > 0) {
                        var discounts;
                        var stt = 0;
                        for (const hd of b) {
                            const urlDiscount = `http://localhost:8080/ban-hang-tai-quay/discounts/${hd.sanphamchitiet.id}`;
                            await fetch(urlDiscount)
                                .then(function (c) {
                                    return c.json();
                                })
                                .then(function (b) {
                                    discounts = b;
                                })
                            if (discounts > 0) {
                                tongTien += hd.soluong * (hd.giasanpham / 100 * (100 - discounts));
                            } else {
                                tongTien += hd.soluong * hd.giasanpham;
                            }
                            stt++;
                            htmlTR += `
                            <tr>
            <td class="text-center" style="vertical-align: middle;">
                <span style="margin-left: 7px">${stt}</span>
            </td>
              <td>
                   <div class="image-container">
                       <img src="${hd.sanphamchitiet.anh[0].tenanh}" alt="" style="height: 100px; width: 100px;">
                       ${discounts > 0 ? `<div class="discount-badge">${discounts}%</div>` : ''}
                   </div>
               </td>
            <td style="vertical-align: middle;">
                <p style="font-weight: bold">${hd.sanphamchitiet.sanpham.tensanpham}</p>
               ${discounts > 0 ? ` <p style="color: red;font-weight: bold">${(hd.giasanpham / 100 * (100 - discounts)).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</p>
      <p class="strikethrough" style="color: black;font-weight: bold">${hd.giasanpham.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</p>
     ` : ` <p style="color: red;font-weight: bold">${hd.giasanpham.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</p>`}
  
                <p> Size: ${hd.sanphamchitiet.kichco.ten}</p>
            </td>
            <td style="vertical-align: middle;">
                <input class="form-control" style="width: 120px;height: 30px; margin-left: 20%;" type="text" id="${hd.id}" value="${hd.soluong}" oninput="changeQuantity(event)">
            </td>
            <td style="color: red;font-weight: bold;vertical-align: middle;">
                ${discounts > 0 ? ` <p style="color: red;font-weight: bold">${((hd.giasanpham / 100 * (100 - discounts)) * hd.soluong).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</p>
     ` : ` <p style="color: red;font-weight: bold">${(hd.soluong * hd.giasanpham).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</p>`}
           
                </td>
            
            <td style="vertical-align: middle;">
                                                           <a href="http://localhost:8080/ban-hang-tai-quay/delete/${hd.id}"
                                                            >
                                                            <button class="btn btn-outline-danger"
                                                                onclick="return confirm('Bạn có muốn xóa sản phẩm này không?')"
                                                                type="button"><i class="bi bi-trash3"></i></button></a>


                                                                <a href="http://localhost:8080/ban-hang-tai-quay/update/${hd.id}/${hd.soluong}" id="${hd.id + 'fsport'}"
                                                            >
                                                            <button class="btn btn-outline-warning"
                                                                onclick="return confirm('Bạn có muốn cập nhật lại sản phẩm này không?')"
                                                                type="button"><i
                                                                    class="bi bi-arrow-clockwise bi-warning"></i></button></a>
            </td>
        </tr>
                            `;
                        }

                        html = `
<div class="tab-pane fade show active text-center fw-bold"
id="tatCaHoaDon-tab-pane" role="tabpanel" aria-labelledby="tatCaHoaDon-tab"
tabindex="0">
<table style="width: 100%" class="table">
    <thead style="height: 50px">
        <tr>
            <th>STT</th>
            <th>Ảnh</th>
            <th>Sản phẩm</th>
            <th>Số lượng</th>
            <th>Tổng tiền</th>
            <th>Thao tác</th>
        </tr>
    </thead>
    <tbody id="boddydssp">`+ htmlTR + `

    </tbody>
</table>
</div>`;
                    }

                    fetch(`http://localhost:8080/ban-hang-tai-quay/fillMaGiam`)
                        .then(function (a) {
                            return a.json();
                        })
                        .then(function (b) {
                            var b2 = b;
                            if (b.phieugiamgia.id != null) {
                                if (b2.phieugiamgia.loaiphieu == true) {
                                    // phiếu %
                                    if (b2.phieugiamgia.giatrigiam * (tongTien / 100) > b2.phieugiamgia.giatrigiamtoida) {
                                        tienGiamT = b2.phieugiamgia.giatrigiamtoida;
                                    } else {
                                        tienGiamT = b2.phieugiamgia.giatrigiam * (tongTien / 100);
                                    }

                                } else {
                                    // phiếu vnđ
                                    tienGiamT = b2.phieugiamgia.giatrigiam;
                                }
                                tongThanhT = tongTien - tienGiamT;
                                document.getElementById('maGiamFill').innerHTML = b.phieugiamgia.macode;
                            } else {
                                document.getElementById('maGiamFill').innerHTML = 'chưa có mã nào phù hợp!';
                                tongThanhT = tongTien;
                            }
                            tongTienDon = tongTien;
                            tienkhachthanhtoan = tongThanhT;
                            TienGiamDon = tienGiamT;
                            hdHienTai = maHD;


                            document.getElementById('giamgia').innerHTML = tienGiamT.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('tongThanhToan').innerHTML = tongThanhT.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });

                        })
                    document.getElementById('GhiDeTab').innerHTML = html;

                    //document.getElementById(invoiceName).innerHTML = html;
                    document.getElementById("tongTien").innerHTML = tongTien.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                    document.getElementById("tongTienTTTT").innerHTML = tongTien.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });

                })


            // Hiển thị nội dung của tab được chọn và thêm class "active" cho tab đó

            document.getElementById(invoiceName).style.display = "block";

        }

        // JavaScript để đóng tab
        function closeTab(tabId) {
            if (confirm("Bạn có chắc chắn muốn loại bỏ hóa đơn " + tabId + " không?")) {
                var tabContent = document.getElementById(tabId);
                if (tabContent) {
                    var urf = "http://localhost:8080/ban-hang-tai-quay/deleteHDCho/" + tabId;
                    window.location.href = urf;
                }
            }
        }

        // Hàm để hiển thị thông báo Toast
        function showToast() {
            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                }
            });

            Toast.fire({
                icon: "error",
                title: "Tồn tại 03 hóa đơn hàng chờ chưa được xử lý, hãy xử lý đơn này trước khi tạo 1 đơn hàng chờ khác!"
            });
        }

        //thay đổi số lượng ở table

        async function changeQuantity(event) {
            const input = event.target;
            let inputValue = input.value;
            var idsp = input.name;
            var idhdct = input.id;

            // Loại bỏ tất cả các ký tự không phải số từ giá trị đầu vào
            inputValue = inputValue.replace(/\D/g, '');

            // Chuyển đổi giá trị thành số
            let numericValue = parseInt(inputValue);

            // Kiểm tra xem giá trị nhập vào có rỗng không
            if (inputValue === '') {
                input.value = '';
                return;
            }

            // Kiểm tra xem giá trị có nằm trong khoảng từ 1 đến 100 không
            var urlVLD = `http://localhost:8080/ban-hang-tai-quay/validate-SL?id=${idhdct}`;
            try {
                const response = await fetch(urlVLD);
                const data = await response.json();
                var slSpTrongDon = data.soluong;
                var slSpCon = data.sanphamchitiet.soluong;

                if (numericValue < 1 || isNaN(numericValue)) {
                    numericValue = 1;
                    thongbao('Số lượng phải lớn hơn 0', 'warning');
                } else {
                    if (slSpCon <= 10) {
                        if (numericValue - slSpTrongDon > slSpCon) {
                            numericValue = slSpCon + slSpTrongDon;
                            thongbao('Số lượng đang vượt quá số lượng hàng hiện có', 'warning');

                        }
                    } else {
                        if (numericValue > 10) {
                            thongbao('Chỉ được chọn tối đa 10 sản phẩm', 'warning');
                            numericValue = 10;
                        }
                    }
                }

                // Cập nhật giá trị của input
                input.value = numericValue;

                var element = document.getElementById(input.id + 'fsport');
                var newHref = "http://localhost:8080/ban-hang-tai-quay/update/" + input.id + "/" + input.value;
                element.setAttribute("href", newHref);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // function changeQuantity(event) {
        //     const input = event.target;
        //     let inputValue = input.value;
        //     var idsp = input.name;
        //     var slhientai;
        //     // Loại bỏ tất cả các ký tự không phải số từ giá trị đầu vào
        //     inputValue = inputValue.replace(/\D/g, '');

        //     // Chuyển đổi giá trị thành số
        //     let numericValue = parseInt(inputValue);

        //     // Kiểm tra xem giá trị nhập vào có rỗng không
        //     if (inputValue === '') {
        //         input.value = '';
        //         return;
        //     }
        //     //thongbao('Số lượng phải lớn hơn 0','warning');
        //     // Kiểm tra xem giá trị có nằm trong khoảng từ 1 đến 100 không
        //     var urlVLD = `http://localhost:8080/ban-hang-tai-quay/validate-SL?id=${idsp}`;
        //     fetch(urlVLD)
        //         .then(function (c) {
        //             return c.json();
        //         })
        //         .then(function (b) {
        //             slhientai = b.soluong;

        //         })

        //     alert(slhientai)
        //     if (numericValue < 1 || isNaN(numericValue)) {
        //         numericValue = 1;
        //     } else if (numericValue > 100) {
        //         numericValue = 100;
        //     }

        //     // Cập nhật giá trị của input
        //     input.value = numericValue;

        //     var element = document.getElementById(input.id + 'fsport');
        //     var newHref = " http://localhost:8080/ban-hang-tai-quay/update/" + input.id + "/" + input.value;
        //     element.setAttribute("href", newHref);
        // }
    </script>
    <!-- thay đổi sản phẩm hdct -->
    <script>
        let thisNumberSPPage = 0;
        var reloadSP = document.getElementById('reloadsp');
        var btnSP = document.getElementById('changeSP');
        var nextPageSP = document.getElementById('nextPageSP');
        var prevPageSP = document.getElementById('prevPageSP');
        var tensp = document.getElementById('tensp');
        var chatlieu = document.getElementById('chatlieu');
        var thuonghieu = document.getElementById('thuonghieu');
        var degiay = document.getElementById('degiay');
        var kichco = document.getElementById('kichco');
        var mausac = document.getElementById('mausac');
        var gioitinh = document.getElementById('gioitinh');
        var khoanggia = document.getElementById('priceRange');
        //lấy % giảm của sp

        function SearchSPHDCT() {
            var tentim = tensp.value;
            var cl = chatlieu.value;
            var th = thuonghieu.value;
            var dg = degiay.value;
            var kc = kichco.value;
            var ms = mausac.value;
            var gt = gioitinh.value;
            var kg = khoanggia.value;
            var list = [
                tentim, cl, th, dg, kc, ms, gt, kg
            ]
            let encodedList = list.map(item => encodeURIComponent(item));
            var urltimSPCT = `/hoa-don/searchSP?lstData=${encodedList.join(",")}`;
            //var urltimSPCT = `/hoa-don/searchSP?lstData=${list}`;
            fetch(urltimSPCT)
                .then(function (c) {
                    return c.json();
                })
                .then(async function (b) {
                    var discounts;
                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b) {
                        const urlDiscount = `http://localhost:8080/ban-hang-tai-quay/discounts/${hd.id}`;
                        await fetch(urlDiscount)
                            .then(function (c) {
                                return c.json();
                            })
                            .then(function (b) {
                                discounts = b;
                            })
                        STT++;
                        htmlSP += `<tr>
                                   <td style="vertical-align: middle;">${STT}</td>
                                <td>
                   <div class="image-container">
                       <img src="${hd.anh[0].tenanh}" alt="" style="height: 100px; width: 100px;">
                       ${discounts > 0 ? `<div class="discount-badge">${discounts}%</div>` : ''}
                   </div>
               </td>
                                   <td style="vertical-align: middle;">${hd.sanpham.tensanpham}</td>
                                   <td style="vertical-align: middle;">${hd.soluong}</td>
                                   <td style="vertical-align: middle;">${hd.kichco.ten}</td>
                                   <td style="vertical-align: middle;">
                                     <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: ${hd.mausac.ten}; padding: 3px 15px 3px 15px; color: white;">
                                       ${hd.mausac.ten}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;
                    document.getElementById('navAddSPHDCT').style.display = 'none';

                })
        }




        tensp.onkeyup = function () {
            var tentim = tensp.value;
            var cl = chatlieu.value;
            var th = thuonghieu.value;
            var dg = degiay.value;
            var kc = kichco.value;
            var ms = mausac.value;
            var gt = gioitinh.value;
            var kg = khoanggia.value;
            var list = [
                tentim, cl, th, dg, kc, ms, gt, kg
            ]
            let encodedList = list.map(item => encodeURIComponent(item));
            var urltimSPCT = `/hoa-don/searchSP?lstData=${encodedList.join(",")}`;
            //var urltimSPCT = `/hoa-don/searchSP?lstData=${list}`;
            fetch(urltimSPCT)
                .then(function (c) {
                    return c.json();
                })
                .then(async function (b) {
                    var discounts;
                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b) {
                        const urlDiscount = `http://localhost:8080/ban-hang-tai-quay/discounts/${hd.id}`;
                        await fetch(urlDiscount)
                            .then(function (c) {
                                return c.json();
                            })
                            .then(function (b) {
                                discounts = b;
                            })
                        STT++;
                        htmlSP += `<tr>
                                   <td style="vertical-align: middle;">${STT}</td>
                                 <td>
                   <div class="image-container">
                       <img src="${hd.anh[0].tenanh}" alt="" style="height: 100px; width: 100px;">
                       ${discounts > 0 ? `<div class="discount-badge">${discounts}%</div>` : ''}
                   </div>
               </td>
                                   <td style="vertical-align: middle;">${hd.sanpham.tensanpham}</td>
                                   <td style="vertical-align: middle;">${hd.soluong}</td>
                                   <td style="vertical-align: middle;">${hd.kichco.ten}</td>
                                   <td style="vertical-align: middle;">
                                     <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: ${hd.mausac.ten}; padding: 3px 15px 3px 15px; color: white;">
                                       ${hd.mausac.ten}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;
                    document.getElementById('navAddSPHDCT').style.display = 'none';

                })
        }







        reloadSP.onclick = function () {
            const pageSPChanges = localStorage.getItem("pageSPChanges") ?? 0;
            const urlPage = `/hoa-don/viewSPChanges?pageSPChanges=${pageSPChanges}`;

            fetch(urlPage)
                .then(function (c) {
                    return c.json();
                })
                .then(async function (b) {
                    var discounts;
                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b.content) {
                        const urlDiscount = `http://localhost:8080/ban-hang-tai-quay/discounts/${hd.id}`;
                        await fetch(urlDiscount)
                            .then(function (c) {
                                return c.json();
                            })
                            .then(function (b) {
                                discounts = b;
                            })
                        STT++;
                        htmlSP += `<tr>
                                   <td style="vertical-align: middle;">${STT}</td>
                                  <td>
                   <div class="image-container">
                       <img src="${hd.anh[0].tenanh}" alt="" style="height: 100px; width: 100px;">
                       ${discounts > 0 ? `<div class="discount-badge">${discounts}%</div>` : ''}
                   </div>
               </td>
                                   <td style="vertical-align: middle;">${hd.sanpham.tensanpham}</td>
                                   <td style="vertical-align: middle;">${hd.soluong}</td>
                                   <td style="vertical-align: middle;">${hd.kichco.ten}</td>
                                   <td style="vertical-align: middle;">
                                     <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: ${hd.mausac.ten}; padding: 3px 15px 3px 15px; color: white;">
                                       ${hd.mausac.ten}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;

                    }

                    if (thisNumberSPPage < 1) {
                        prevPageSP.style.display = 'none';
                    } else {
                        prevPageSP.style.display = 'block';
                    }
                    if (thisNumberSPPage >= b.totalPages - 1) {
                        nextPageSP.style.display = 'none';
                    } else {
                        nextPageSP.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPageSP += `
                            <a class="page-link" onclick="pageClickSP( ${i - 1})">
                                                                                        ${i}
                             </a>
                            `;
                    }
                    document.getElementById('navAddSPHDCT').style.display = 'block';
                    document.getElementById("numberPageSP").innerHTML = htmlNumberPageSP;
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;

                })
        }


        btnSP.onclick = function () {
            const pageSPChanges = localStorage.getItem("pageSPChanges") ?? 0;
            const urlPage = `/hoa-don/viewSPChanges?pageSPChanges=${pageSPChanges}`;

            fetch(urlPage)
                .then(function (c) {
                    return c.json();
                })
                .then(async function (b) {
                    var discounts;
                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b.content) {
                        const urlDiscount = `http://localhost:8080/ban-hang-tai-quay/discounts/${hd.id}`;
                        await fetch(urlDiscount)
                            .then(function (c) {
                                return c.json();
                            })
                            .then(function (b) {
                                discounts = b;
                            })
                        STT++;
                        htmlSP += `<tr>
                                   <td style="vertical-align: middle;">${STT}</td>
                                  <td>
                   <div class="image-container">
                       <img src="${hd.anh[0].tenanh}" alt="" style="height: 100px; width: 100px;">
                       ${discounts > 0 ? `<div class="discount-badge">${discounts}%</div>` : ''}
                   </div>
               </td>
                                   <td style="vertical-align: middle;">${hd.sanpham.tensanpham}</td>
                                   <td style="vertical-align: middle;">${hd.soluong}</td>
                                   <td style="vertical-align: middle;">${hd.kichco.ten}</td>
                                   <td style="vertical-align: middle;">
                                     <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: ${hd.mausac.ten}; padding: 3px 15px 3px 15px; color: white;">
                                       ${hd.mausac.ten}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }

                    if (thisNumberSPPage < 1) {
                        prevPageSP.style.display = 'none';
                    } else {
                        prevPageSP.style.display = 'block';
                    }
                    if (thisNumberSPPage >= b.totalPages - 1) {
                        nextPageSP.style.display = 'none';
                    } else {
                        nextPageSP.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPageSP += `
                            <a class="page-link" onclick="pageClickSP( ${i - 1})">
                                                                                        ${i}
                             </a>
                            `;
                    }
                    document.getElementById("numberPageSP").innerHTML = htmlNumberPageSP;
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;

                })
        }

        function pageClickSP(numbers) {
            const pageSPChanges = localStorage.getItem("pageSPChanges") ?? numbers;
            const urlPage = `/hoa-don/viewSPChanges?pageSPChanges=${pageSPChanges}`;
            fetch(urlPage)
                .then(function (a) {
                    return a.json();
                })
                .then(async function (b) {
                    var discounts;
                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b.content) {
                        const urlDiscount = `http://localhost:8080/ban-hang-tai-quay/discounts/${hd.id}`;
                        await fetch(urlDiscount)
                            .then(function (c) {
                                return c.json();
                            })
                            .then(function (b) {
                                discounts = b;
                            })
                        STT++;
                        htmlSP += `<tr>
                                   <td style="vertical-align: middle;">${STT}</td>
                                 <td>
                   <div class="image-container">
                       <img src="${hd.anh[0].tenanh}" alt="" style="height: 100px; width: 100px;">
                       ${discounts > 0 ? `<div class="discount-badge">${discounts}%</div>` : ''}
                   </div>
               </td>
                                   <td style="vertical-align: middle;">${hd.sanpham.tensanpham}</td>
                                   <td style="vertical-align: middle;">${hd.soluong}</td>
                                   <td style="vertical-align: middle;">${hd.kichco.ten}</td>
                                   <td style="vertical-align: middle;">
                                     <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: ${hd.mausac.ten}; padding: 3px 15px 3px 15px; color: white;">
                                       ${hd.mausac.ten}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }

                    if (thisNumberSPPage < 1) {
                        prevPageSP.style.display = 'none';
                    } else {
                        prevPageSP.style.display = 'block';
                    }
                    if (thisNumberSPPage >= b.totalPages - 1) {
                        nextPageSP.style.display = 'none';
                    } else {
                        nextPageSP.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPageSP += `
                            <a class="page-link" onclick="pageClickSP( ${i - 1})">
                                                                                        ${i}
                             </a>
                            `;
                    }
                    document.getElementById("numberPageSP").innerHTML = htmlNumberPageSP;
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;

                })
        }


        nextPageSP.onclick = function () {
            thisNumberSPPage++;
            const pageSPChanges = localStorage.getItem("pageSPChanges") ?? thisNumberSPPage;
            const urlPage = `/hoa-don/viewSPChanges?pageSPChanges=${pageSPChanges}`;
            fetch(urlPage)
                .then(function (a) {
                    return a.json();
                })
                .then(async function (b) {
                    var discounts;
                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b.content) {
                        const urlDiscount = `http://localhost:8080/ban-hang-tai-quay/discounts/${hd.id}`;
                        await fetch(urlDiscount)
                            .then(function (c) {
                                return c.json();
                            })
                            .then(function (b) {
                                discounts = b;
                            })
                        STT++;
                        htmlSP += `<tr>
                                   <td style="vertical-align: middle;">${STT}</td>
                                <td>
                   <div class="image-container">
                       <img src="${hd.anh[0].tenanh}" alt="" style="height: 100px; width: 100px;">
                       ${discounts > 0 ? `<div class="discount-badge">${discounts}%</div>` : ''}
                   </div>
               </td>
                                   <td style="vertical-align: middle;">${hd.sanpham.tensanpham}</td>
                                   <td style="vertical-align: middle;">${hd.soluong}</td>
                                   <td style="vertical-align: middle;">${hd.kichco.ten}</td>
                                  <td style="vertical-align: middle;">
                                     <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: ${hd.mausac.ten}; padding: 3px 15px 3px 15px; color: white;">
                                       ${hd.mausac.ten}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }

                    if (thisNumberSPPage < 1) {
                        prevPageSP.style.display = 'none';
                    } else {
                        prevPageSP.style.display = 'block';
                    }
                    if (thisNumberSPPage >= b.totalPages - 1) {
                        nextPageSP.style.display = 'none';
                    } else {
                        nextPageSP.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPageSP += `
                            <a class="page-link" onclick="pageClickSP( ${i - 1})">
                                                                                        ${i}
                             </a>
                            `;
                    }
                    document.getElementById("numberPageSP").innerHTML = htmlNumberPageSP;
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;

                })
        }



        prevPageSP.onclick = function () {

            thisNumberSPPage--;
            const pageSPChanges = localStorage.getItem("pageSPChanges") ?? thisNumberSPPage;
            const urlPage = `/hoa-don/viewSPChanges?pageSPChanges=${pageSPChanges}`;
            fetch(urlPage)
                .then(function (a) {
                    return a.json();
                })
                .then(async function (b) {
                    var discounts;
                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b.content) {
                        const urlDiscount = `http://localhost:8080/ban-hang-tai-quay/discounts/${hd.id}`;
                        await fetch(urlDiscount)
                            .then(function (c) {
                                return c.json();
                            })
                            .then(function (b) {
                                discounts = b;
                            })
                        STT++;
                        htmlSP += `<tr>
                                   <td style="vertical-align: middle;">${STT}</td>
                                  <td>
                   <div class="image-container">
                       <img src="${hd.anh[0].tenanh}" alt="" style="height: 100px; width: 100px;">
                       ${discounts > 0 ? `<div class="discount-badge">${discounts}%</div>` : ''}
                   </div>
               </td>
                                   <td style="vertical-align: middle;">${hd.sanpham.tensanpham}</td>
                                   <td style="vertical-align: middle;">${hd.soluong}</td>
                                   <td style="vertical-align: middle;">${hd.kichco.ten}</td>
                                   <td style="vertical-align: middle;">
                                     <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: ${hd.mausac.ten}; padding: 3px 15px 3px 15px; color: white;">
                                       ${hd.mausac.ten}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td style="vertical-align: middle;">
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }

                    if (thisNumberSPPage < 1) {
                        prevPageSP.style.display = 'none';
                    } else {
                        prevPageSP.style.display = 'block';
                    }
                    if (thisNumberSPPage >= b.totalPages - 1) {
                        nextPageSP.style.display = 'none';
                    } else {
                        nextPageSP.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPageSP += `
                            <a class="page-link" onclick="pageClickSP( ${i - 1})">
                                                                                        ${i}
                             </a>
                            `;
                    }
                    document.getElementById("numberPageSP").innerHTML = htmlNumberPageSP;
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;

                })
        }

    </script>

    <script>
        // Lấy phần tử thanh trượt và phần tử hiển thị giá trị
        var priceRange = document.getElementById("priceRange");
        var priceRangeValue = document.getElementById("priceRangeValue");

        // Lắng nghe sự kiện khi người dùng thay đổi giá trị thanh trượt
        priceRange.oninput = function () {
            // Cập nhật giá trị hiển thị
            var show = this.value
                .replace(/\D/g, "")
                .replace(/([0-9])([0-9]{})$/, '$1.$2')
                .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ",");
            priceRangeValue.innerText = show + ' đ';
        };
    </script>



    <!-- thay đổi khách hàng -->
    <script>
        let thisNumberPage = 0;

        var reload = document.getElementById('reloadnv');
        var btn = document.getElementById('changeNV');
        var nextPage = document.getElementById('nextPage');
        var prevPage = document.getElementById('prevPage');
        var navNV = document.getElementById('navNV');

        reload.onclick = function () {
            const pageNVChanges = localStorage.getItem("pageNVChanges") ?? 0;
            const url = `/ban-hang-tai-quay/viewNVChanges?pageNVChanges=${pageNVChanges}`;
            fetch(url)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let html = '';
                    let htmlNumberPage = '';
                    for (const hd of b.content) {
                        STT++;
                        html += `<tr>
                               <td>${STT}</td>
                               <td>${hd.makhachhang}</td>
                               <td>${hd.nguoidung.hovaten}</td>
                               <td>${hd.nguoidung.sodienthoai}</td>
                               <td>${hd.nguoidung.ngaysinh}</td>
                               <td>${hd.nguoidung.gioitinh == true ? 'Nam' : 'Nữ'}</td>
                               <td>
                                <a href="http://localhost:8080/ban-hang-tai-quay/ChoseKH/${hd.id}"><button
                                class="btn btn-warning">
                                chọn
                                 </button></a>
                                 </td>
                            </tr>`;
                    }

                    if (thisNumberPage < 1) {
                        prevPage.style.display = 'none';
                    } else {
                        prevPage.style.display = 'block';
                    }
                    if (thisNumberPage >= b.totalPages - 1) {
                        nextPage.style.display = 'none';
                    } else {
                        nextPage.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPage += `
                        <a class="page-link" onclick="pageClick( ${i - 1})">
                                                                                    ${i}
                         </a>
                        `;
                    }
                    document.getElementById('navNV').style.display = 'block';
                    document.getElementById("numberPage").innerHTML = htmlNumberPage;
                    document.getElementById("tbl_doi_nv").innerHTML = html;

                })
        }




        btn.onclick = function () {
            const pageNVChanges = localStorage.getItem("pageNVChanges") ?? 0;
            const url = `/ban-hang-tai-quay/viewNVChanges?pageNVChanges=${pageNVChanges}`;
            fetch(url)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let html = '';
                    let htmlNumberPage = '';
                    for (const hd of b.content) {
                        STT++;
                        html += `<tr>
                               <td>${STT}</td>
                               <td>${hd.makhachhang}</td>
                               <td>${hd.nguoidung.hovaten}</td>
                               <td>${hd.nguoidung.sodienthoai}</td>
                               <td>${hd.nguoidung.ngaysinh}</td>
                               <td>${hd.nguoidung.gioitinh == true ? 'Nam' : 'Nữ'}</td>
                               <td>
                                <a href="http://localhost:8080/ban-hang-tai-quay/ChoseKH/${hd.id}"><button
                                class="btn btn-warning">
                                chọn
                                 </button></a>
                                 </td>
                            </tr>`;
                    }

                    if (thisNumberPage < 1) {
                        prevPage.style.display = 'none';
                    } else {
                        prevPage.style.display = 'block';
                    }
                    if (thisNumberPage >= b.totalPages - 1) {
                        nextPage.style.display = 'none';
                    } else {
                        nextPage.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPage += `
                        <a class="page-link" onclick="pageClick( ${i - 1})">
                                                                                    ${i}
                         </a>
                        `;
                    }
                    document.getElementById('navNV').style.display = 'block';
                    document.getElementById("numberPage").innerHTML = htmlNumberPage;
                    document.getElementById("tbl_doi_nv").innerHTML = html;

                })
        }

        var searchNV = document.getElementById('searchNV');

        searchNV.onkeyup = function () {
            var keySearch = searchNV.value;
            var url = `/ban-hang-tai-quay/searchNV?keySearch=${keySearch}`;
            fetch(url)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let html = '';
                    for (const hd of b) {
                        STT++;
                        html += `<tr>
                       <td>${STT}</td>
                       <td>${hd.makhachhang}</td>
                       <td>${hd.nguoidung.hovaten}</td>
                       <td>${hd.nguoidung.sodienthoai}</td>
                       <td>${hd.nguoidung.ngaysinh}</td>
                       <td>${hd.nguoidung.gioitinh == true ? 'Nam' : 'Nữ'}</td>
                       <td>
                        <a href="http://localhost:8080/ban-hang-tai-quay/ChoseKH/${hd.id}"><button
                        class="btn btn-warning">
                        chọn
                         </button></a>
                         </td>
                    </tr>`;
                    }
                    document.getElementById('navNV').style.display = 'none';
                    document.getElementById("tbl_doi_nv").innerHTML = html;
                })
        }


        function pageClick(number) {
            const pageNVChanges = localStorage.getItem("pageNVChanges") ?? number;
            const url = `/ban-hang-tai-quay/viewNVChanges?pageNVChanges=${pageNVChanges}`;
            fetch(url)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let html = '';
                    let htmlNumberPage = '';
                    for (const hd of b.content) {
                        STT++;
                        html += `<tr>
                               <td>${STT}</td>
                               <td>${hd.makhachhang}</td>
                               <td>${hd.nguoidung.hovaten}</td>
                               <td>${hd.nguoidung.sodienthoai}</td>
                               <td>${hd.nguoidung.ngaysinh}</td>
                               <td>${hd.nguoidung.gioitinh == true ? 'Nam' : 'Nữ'}</td>
                               <td>
                                <a href="http://localhost:8080/ban-hang-tai-quay/ChoseKH/${hd.id}"><button
                                class="btn btn-warning">
                                chọn
                                 </button></a>
                                 </td>
                            </tr>`;
                    }
                    if (thisNumberPage < 1) {
                        prevPage.style.display = 'none';
                    } else {
                        prevPage.style.display = 'block';
                    }
                    if (thisNumberPage >= b.totalPages - 1) {
                        nextPage.style.display = 'none';
                    } else {
                        nextPage.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPage += `
                        <a class="page-link" onclick="pageClick( ${i - 1})">
                                                                                    ${i}
                         </a>
                        `;
                    }
                    document.getElementById("numberPage").innerHTML = htmlNumberPage;
                    document.getElementById("tbl_doi_nv").innerHTML = html;

                })
        }

        nextPage.onclick = function () {
            thisNumberPage++;
            const pageNVChanges = localStorage.getItem("pageNVChanges") ?? thisNumberPage;
            const url = `/ban-hang-tai-quay/viewNVChanges?pageNVChanges=${pageNVChanges}`;
            fetch(url)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let html = '';
                    let htmlNumberPage = '';
                    for (const hd of b.content) {
                        STT++;
                        html += `<tr>
                               <td>${STT}</td>
                               <td>${hd.makhachhang}</td>
                               <td>${hd.nguoidung.hovaten}</td>
                               <td>${hd.nguoidung.sodienthoai}</td>
                               <td>${hd.nguoidung.ngaysinh}</td>
                               <td>${hd.nguoidung.gioitinh == true ? 'Nam' : 'Nữ'}</td>
                               <td>
                                <a href="http://localhost:8080/ban-hang-tai-quay/ChoseKH/${hd.id}"><button
                                class="btn btn-warning">
                                chọn
                                 </button></a>
                                 </td>
                            </tr>`;
                    }
                    if (thisNumberPage < 1) {
                        prevPage.style.display = 'none';
                    } else {
                        prevPage.style.display = 'block';
                    }
                    if (thisNumberPage >= b.totalPages - 1) {
                        nextPage.style.display = 'none';
                    } else {
                        nextPage.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPage += `
                        <a class="page-link" onclick="pageClick( ${i - 1})">
                                                                                    ${i}
                         </a>
                        `;
                    }
                    document.getElementById("numberPage").innerHTML = htmlNumberPage;
                    document.getElementById("tbl_doi_nv").innerHTML = html;

                })
        }



        prevPage.onclick = function () {

            thisNumberPage--;
            const pageNVChanges = localStorage.getItem("pageNVChanges") ?? thisNumberPage;
            const url = `/ban-hang-tai-quay/viewNVChanges?pageNVChanges=${pageNVChanges}`;
            fetch(url)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let html = '';
                    let htmlNumberPage = '';

                    for (const hd of b.content) {
                        STT++;
                        html += `<tr>
                               <td>${STT}</td>
                               <td>${hd.makhachhang}</td>
                               <td>${hd.nguoidung.hovaten}</td>
                               <td>${hd.nguoidung.sodienthoai}</td>
                               <td>${hd.nguoidung.ngaysinh}</td>
                               <td>${hd.nguoidung.gioitinh == true ? 'Nam' : 'Nữ'}</td>
                               <td>
                                <a href="http://localhost:8080/ban-hang-tai-quay/ChoseKH/${hd.id}"><button
                                class="btn btn-warning">
                                chọn
                                 </button></a>
                                 </td>
                            </tr>`;
                    }
                    if (thisNumberPage < 1) {
                        prevPage.style.display = 'none';
                    } else {
                        prevPage.style.display = 'block';
                    }
                    if (thisNumberPage >= b.totalPages - 1) {
                        nextPage.style.display = 'none';
                    } else {
                        nextPage.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPage += `
                        <a class="page-link" onclick="pageClick( ${i - 1})">
                                                                                    ${i}
                         </a>
                        `;
                    }
                    document.getElementById("numberPage").innerHTML = htmlNumberPage;
                    document.getElementById("tbl_doi_nv").innerHTML = html;

                })
        }
        //hiển thị nút trả sau trước

        function giaohang(event) {
            document.getElementById('phigiaohang').value = '';
            const urlchecksize = `http://localhost:8080/ban-hang-tai-quay/checkGiaoThanhToan`;
            fetch(urlchecksize)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    if (b === true) {
                        if (tienkhachthanhtoan === 0) {
                            document.getElementById("checktrasau").checked = false;
                            thongbao('Bạn chưa chọn sản phẩm nào', 'warning')
                        } else {
                            var isChecked = event.target.checked;
                            if (isChecked) {
                                // hiển thị div 
                                document.getElementById('diachidiv').style.display = 'block';
                                showdiachimacdinh();

                            } else {
                                // ẩn div
                                tienkhachthanhtoan = tienkhachthanhtoan - shipToanCuc;
                                document.getElementById('diachidiv').style.display = 'none';

                            }
                        }

                    } else {

                        document.getElementById("checktrasau").checked = false;
                        thongbao('Chưa có hóa đơn nào được chọn', 'warning')
                    }
                })
        }


        // function giaohang() {
        //     var htmltrasau = '';
        //     var htmldiachi = '';
        //     var htmlPhiVanChuyen = '';

        //     htmlPhiVanChuyen = ` <p style="font-weight: bold">Phí vận chuyển:</p>
        //                     <p>
        //                         <input type="text" style="width: 180px;height: 30px" class="form-control" oninput="showcasst('phigiaohang')" id="phigiaohang">
        //                     </p>`;

        //     htmltrasau = `  <p style="font-weight: bold">Trả sau:</p>
        //                     <p class="form-check form-switch">
        //                         <input class="form-check-input" type="checkbox" role="switch" id="trasau">
        //                     </p>`;
        //     htmldiachi = `  <form th:object="${thongtingiaohang}">
        //                           <p>
        //                     <input type="text" class="form-control" placeholder="Nhập họ và tên" th:field="*{ten}">
        //                 </p>
        //                 <p>
        //                     <input type="text" class="form-control" placeholder="Nhập số điện thoại" th:field="*{sdt}">
        //                 </p>
        //                 <p>
        //                     <input type="text" class="form-control" placeholder="Nhập email" th:field="*{email}">
        //                 </p>
        //                 <p>
        //                     <input type="text" class="form-control" placeholder="Nhập địa chỉ" th:field="*{diachi}">
        //                 </p>
        //                 <p class="d-flex">
        //                     <select class="form-select form-select-sm mb-3" id="city" th:field="*{tinh}">
        //                                 <option value="" th:text="*{tinh}" selected>
        //                                     Chọn tỉnh thành</option>
        //                             </select>
        //                             <select class="form-select form-select-sm mb-3" id="district" th:field="*{huyen}">
        //                                 <option value="" th:text="*{huyen}" selected>Chọn quận huyện</option>
        //                             </select>
        //                             <select class="form-select form-select-sm mb-3" id="ward" th:field="*{xa}">
        //                                 <option value="" th:text="*{xa}" selected>
        //                                     Chọn phường xã</option>
        //                             </select>
        //                 </p>
        //                 <p>
        //                     <textarea class="form-control" placeholder="Ghi chú" th:field="*{ghichu}"></textarea>
        //                 </p> 
        //             </form>
        //                 `;
        //     var checkBox = document.getElementById('checktrasau');
        //     if (checkBox.checked) {
        //         document.getElementById('trasauhtml').innerHTML = htmltrasau;
        //         document.getElementById('diachihtml').innerHTML = htmldiachi;
        //         document.getElementById('phiShip').innerHTML = htmlPhiVanChuyen;
        //     } else {
        //         document.getElementById('trasauhtml').innerHTML = '';
        //         document.getElementById('diachihtml').innerHTML = '';
        //         document.getElementById('phiShip').innerHTML = '';
        //     }

        // }

        function seton() {
            var check = document.getElementById('inputThemNhanh');
            var show = document.getElementById('showndcheck');
            var htmlshowon = '';
            if (check.checked) {
                htmlshowon = ` <p style="font-style: italic;">Thêm nhanh và lựa chọn khách hàng cho hóa đơn!</p>`;
                show.innerHTML = htmlshowon;
            }

            else {
                htmlshowon = ` <p style="text-decoration: line-through; font-style: italic;">Thêm nhanh và lựa chọn khách hàng cho hóa đơn!</p>`;
                show.innerHTML = htmlshowon;
            }
        }
    </script>


    <!-- call api địa chỉ cho thêm địa chỉ giao hàng -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        var citiesSelect = document.getElementById("tinhthanh");
        var districtsSelect = document.getElementById("quanhuyen");
        var wardsSelect = document.getElementById("xaphuong");
        var ajaxParameters = {
            url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
            method: "GET",
            responseType: "application/json",
        };
        var ajaxPromise = axios(ajaxParameters);
        ajaxPromise.then(function (response) {
            populateCities(response.data);
        });

        function populateCities(data) {
            for (const city of data) {
                var optionElement = document.createElement('option');
                optionElement.value = city.Name;
                optionElement.text = city.Name;
                optionElement.setAttribute('data-id', city.Id);
                citiesSelect.options.add(optionElement);
            }
            citiesSelect.onchange = function () {
                districtsSelect.length = 1;
                wardsSelect.length = 1;
                if (this.options[this.selectedIndex].dataset.id != "") {
                    const selectedCity = data.filter(city => city.Id === this.options[this.selectedIndex].dataset.id);

                    for (const district of selectedCity[0].Districts) {
                        var optionElement = document.createElement('option');
                        optionElement.value = district.Name;
                        optionElement.text = district.Name;
                        optionElement.setAttribute('data-id', district.Id);
                        districtsSelect.options.add(optionElement);
                    }
                }
            };
            districtsSelect.onchange = function () {
                wardsSelect.length = 1;
                const selectedCityData = data.filter(city => city.Id === citiesSelect.options[citiesSelect.selectedIndex].dataset.id);
                if (this.options[this.selectedIndex].dataset.id != "") {
                    const selectedDistrictWards = selectedCityData[0].Districts.filter(district => district.Id === this.options[this.selectedIndex].dataset.id)[0].Wards;

                    for (const ward of selectedDistrictWards) {
                        var optionElement = document.createElement('option');
                        optionElement.value = ward.Name;
                        optionElement.text = ward.Name;
                        optionElement.setAttribute('data-id', ward.Id);
                        wardsSelect.options.add(optionElement);
                    }
                }
            };
        }
    </script>
    <!-- <script>
        var thanhpho = document.getElementById("tinhthanh");
        var huyen = document.getElementById("quanhuyen");
        var phuong = document.getElementById("xaphuong");
        var para = {
            url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
            method: "GET",
            responseType: "application/json",
        };
        var pro = axios(para);
        pro.then(function (result) {
            renCity(result.data);
        });

        function renCity(data) {
            for (const x of data) {
                var opt = document.createElement('option');
                opt.value = x.Name;
                opt.text = x.Name;
                opt.setAttribute('data-id', x.Id);
                thanhpho.options.add(opt);
            }
            thanhpho.onchange = function () {
                huyen.length = 1;
                ward.length = 1;
                if (this.options[this.selectedIndex].dataset.id != "") {
                    const result = data.filter(n => n.Id === this.options[this.selectedIndex].dataset.id);

                    for (const k of result[0].huyen) {
                        var opt = document.createElement('option');
                        opt.value = k.Name;
                        opt.text = k.Name;
                        opt.setAttribute('data-id', k.Id);
                        huyen.options.add(opt);
                    }
                }
            };
            huyen.onchange = function () {
                alert("distric")
                ward.length = 1;
                const dataCity = data.filter((n) => n.Id === thanhpho.options[thanhpho.selectedIndex].dataset.id);
                if (this.options[this.selectedIndex].dataset.id != "") {
                    const dataWards = dataCity[0].huyen.filter(n => n.Id === this.options[this.selectedIndex].dataset.id)[0].phuong;

                    for (const w of dataWards) {
                        var opt = document.createElement('option');
                        opt.value = w.Name;
                        opt.text = w.Name;
                        opt.setAttribute('data-id', w.Id);
                        phuong.options.add(opt);
                    }
                }
            };
        }
    </script> -->


    <!--call địa chỉ cho thêm nhanh khách hàng-->
    <script>
        var citis = document.getElementById("city");
        var districts = document.getElementById("district");
        var wards = document.getElementById("ward");
        var Parameter = {
            url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
            method: "GET",
            responseType: "application/json",
        };
        var promise = axios(Parameter);
        promise.then(function (result) {
            renderCity(result.data);
        });

        function renderCity(data) {
            for (const x of data) {
                var opt = document.createElement('option');
                opt.value = x.Name;
                opt.text = x.Name;
                opt.setAttribute('data-id', x.Id);
                citis.options.add(opt);
            }
            citis.onchange = function () {
                district.length = 1;
                ward.length = 1;
                if (this.options[this.selectedIndex].dataset.id != "") {
                    const result = data.filter(n => n.Id === this.options[this.selectedIndex].dataset.id);

                    for (const k of result[0].Districts) {
                        var opt = document.createElement('option');
                        opt.value = k.Name;
                        opt.text = k.Name;
                        opt.setAttribute('data-id', k.Id);
                        district.options.add(opt);
                    }
                }
            };
            district.onchange = function () {
                ward.length = 1;
                const dataCity = data.filter((n) => n.Id === citis.options[citis.selectedIndex].dataset.id);
                if (this.options[this.selectedIndex].dataset.id != "") {
                    const dataWards = dataCity[0].Districts.filter(n => n.Id === this.options[this.selectedIndex].dataset.id)[0].Wards;

                    for (const w of dataWards) {
                        var opt = document.createElement('option');
                        opt.value = w.Name;
                        opt.text = w.Name;
                        opt.setAttribute('data-id', w.Id);
                        wards.options.add(opt);
                    }
                }
            };
        }



        // thanh toán modal hóa đơn
        function thanhtoan() {
            const urlchecksize = `http://localhost:8080/ban-hang-tai-quay/checkGiaoThanhToan`;
            fetch(urlchecksize)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    if (b === true) {
                        const urlthanhtoan = `http://localhost:8080/ban-hang-tai-quay/thanh-toan`;
                        fetch(urlthanhtoan)
                            .then(function (a) {
                                return a.json();
                            })
                            .then(function (b) {
                                var htmlpt = '';
                                if (b.length > 0) {
                                    var stt = 0;
                                    var tiendathanhtoan = 0;
                                    var checktienmat = 0;
                                    var checkchuyenkhoan = 0;
                                    for (const hd of b) {
                                        if (hd.mota == 'tiền mặt') {
                                            checktienmat = 1;

                                        }
                                        if (hd.mota == 'chuyển khoản') {
                                            checkchuyenkhoan = 1;
                                        }
                                        tiendathanhtoan += hd.tongtien;
                                        stt++;
                                        htmlpt += ` <tr>
                                              <td>${stt}</td>
                                              <td>${hd.magiaodichvnpay == null ? '' : hd.magiaodichvnpay}</td>
                                              <td>${hd.tongtien}</td>
                                              <td>${hd.mota}</td>
                                              <td>
                                                <a onclick="xoaphuongthuc('http://localhost:8080/ban-hang-tai-quay/delete-pttt/${hd.tongtien}')"
                                                            >
                                                            <button class="btn btn-outline-danger"
                                                                
                                                                type="button"><i class="bi bi-trash3"></i></button></a>
                                              </td>
                                          </tr>`;
                                    }
                                    if (checkchuyenkhoan == 1) {
                                        document.getElementById('chuyenkhoan').disabled = true;
                                    }
                                    if (checktienmat == 1) {
                                        document.getElementById('tienmat').disabled = true;
                                    }
                                    document.getElementById('dathanhtoanroi').innerHTML = tiendathanhtoan;
                                    document.getElementById('showpt').innerHTML = htmlpt;
                                    var showTien = document.getElementById('sotienhienthi');
                                    showTien.value = (tienkhachthanhtoan - tiendathanhtoan).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                                    document.getElementById('tienthieu').innerHTML = (tienkhachthanhtoan - tiendathanhtoan).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                                    document.getElementById('hdThanhToanShow').innerHTML = hdHienTai;
                                    if (convertCurrency(document.getElementById('sotienhienthi').value) == 0) {
                                        document.getElementById('xacnhanPT').disabled = true;
                                    } else {
                                        document.getElementById('xacnhanPT').disabled = true;
                                    }


                                } else {

                                    var showTien = document.getElementById('sotienhienthi');
                                    document.getElementById('showpt').innerHTML = htmlpt;
                                    showTien.value = tienkhachthanhtoan.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                                    document.getElementById('tienthieu').innerHTML = tienkhachthanhtoan.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                                    document.getElementById('hdThanhToanShow').innerHTML = hdHienTai;
                                    document.getElementById('dathanhtoanroi').innerHTML = '0đ';
                                    if (convertCurrency(document.getElementById('sotienhienthi').value) == 0) {
                                        document.getElementById('xacnhanPT').disabled = true;
                                    } else {
                                        document.getElementById('xacnhanPT').disabled = true;
                                    }

                                }
                                const modalElement = document.getElementById('modalThayDoiHoaDon5');
                                // Khởi tạo một instance của modal
                                const modal = new bootstrap.Modal(modalElement);
                                // Gọi phương thức show để hiển thị modal
                                modal.show();

                            })
                    } else {

                        thongbao('Chưa có hóa đơn nào được chọn', 'warning')
                    }

                })
        }
        // Xóa ký hiệu "₫" và các dấu phân cách khỏi tiền 
        function convertCurrency(formattedAmount) {
            // Xóa ký hiệu "₫" và các dấu phân cách
            let numericAmount = formattedAmount.replace(/[^0-9]/g, '');
            return numericAmount;
        }
        // định dạng show tiền tệ dựa trên onclick
        function showcasst(elementId) {
            $('#' + elementId).keyup(function (event) {
                $(this).val(function (index, value) {
                    return value
                        .replace(/\D/g, "")
                        .replace(/([0-9])([0-9]{})$/, '$1.$2')
                        .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".")
                        + ' ₫';
                });
            });
            // var numberString = document.getElementById('phigiaohang').value.replace(/[^0-9.]/g, '');
            // // Chuyển đổi tiền ship nhập tay
            // var number = parseFloat(numberString.replace(/\./g, ''));
            // shipToanCuc = number;
            // //lấy tiền đã áp voucher
            // var tiensaukhicovucher = document.getElementById('tongThanhToan').textContent.replace(/[^0-9.]/g, '');
            // // Chuyển đổi tiền đã apvoucher thành số nguyên
            // var tienChuaShip = parseFloat(tiensaukhicovucher.replace(/\./g, ''));
            // tienkhachthanhtoan = tienChuaShip + number;

        }
        function showcassts(elementId) {
            $('#' + elementId).keyup(function (event) {
                $(this).val(function (index, value) {
                    return value
                        .replace(/\D/g, "")
                        .replace(/([0-9])([0-9]{})$/, '$1.$2')
                        .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".")
                        + ' ₫';
                });
            });
            var numberString = document.getElementById('phigiaohang').value.replace(/[^0-9.]/g, '');
            // Chuyển đổi tiền ship nhập tay
            var number = parseFloat(numberString.replace(/\./g, ''));
            shipToanCuc = number;
            //lấy tiền đã áp voucher
            var tiensaukhicovucher = document.getElementById('tongThanhToan').textContent.replace(/[^0-9.]/g, '');
            // Chuyển đổi tiền đã apvoucher thành số nguyên
            var tienChuaShip = parseFloat(tiensaukhicovucher.replace(/\./g, ''));
            tienkhachthanhtoan = tienChuaShip + number;

        }


        function xacnhanphuongthuc(inputv) {
            const kieuTT = [inputv, document.getElementById('sotienhienthi').value];
            const urlthanhtoan = `http://localhost:8080/ban-hang-tai-quay/xac-nhan-phuong-thuc?phuongthuc=${kieuTT}`;
            fetch(urlthanhtoan)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    console.log(b)
                    var htmlphuongthuc = '';
                    if (b.length > 0) {
                        //xác nhận phương thức
                        var stt = 0;
                        var tiendathanhtoan = 0;
                        var checktienmat = 0;
                        var checkchuyenkhoan = 0;
                        for (const hd of b) {
                            if (hd.mota == 'tiền mặt') {
                                checktienmat = 1;

                            }
                            if (hd.mota == 'chuyển khoản') {
                                checkchuyenkhoan = 1;
                            }
                            tiendathanhtoan += hd.tongtien;
                            stt++;
                            htmlphuongthuc += ` <tr>
                                            <td>${stt}</td>
                                            <td>${hd.magiaodichvnpay == null ? '' : hd.magiaodichvnpay}</td>
                                            <td>${hd.tongtien.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</td>
                                            <td>${hd.mota}</td>
                                            <td>
                                                <a onclick="xoaphuongthuc('http://localhost:8080/ban-hang-tai-quay/delete-pttt/${hd.tongtien}')"  
                                                            >
                                                            <button class="btn btn-outline-danger"
                                                               
                                                                type="button"><i class="bi bi-trash3"></i></button></a>
                                            </td>
                                        </tr>`;
                        }

                        if (convertCurrency(document.getElementById('sotienhienthi').value) > 0) {
                            if (checkchuyenkhoan == 1) {
                                document.getElementById('chuyenkhoan').disabled = true;
                            }
                            if (checktienmat == 1) {
                                document.getElementById('tienmat').disabled = true;
                            }

                            var tienthieuconlai = tienkhachthanhtoan - tiendathanhtoan;

                            document.getElementById('showpt').innerHTML = htmlphuongthuc;
                            document.getElementById('dathanhtoanroi').innerHTML = tiendathanhtoan.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });;
                            var showTien = document.getElementById('sotienhienthi');
                            showTien.value = tienthieuconlai.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('tienthieu').innerHTML = tienthieuconlai.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('hdThanhToanShow').innerHTML = hdHienTai;
                            if (convertCurrency(document.getElementById('sotienhienthi').value) == 0) {
                                document.getElementById('xacnhanPT').disabled = false;
                            } else {
                                document.getElementById('xacnhanPT').disabled = true;
                            }

                        }

                    } else {

                    }

                })
        }
        function xacnhanthanhcongcf() {
            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                }
            });

            Toast.fire({
                icon: "success",
                title: "Xác nhận thanh toán thành công!"
            });
        }
        //xác nhận phương thức thanh toán
        function xacnhanPTTT() {
            document.getElementById('xacnhanthanhtoanhoadon').disabled = false;
            document.getElementById('changeNV').disabled = true;
            document.getElementById('chonMaGiam').disabled = true;
            document.getElementById('start-scan').disabled = true;
            document.getElementById('themKHS').disabled = true;
            document.getElementById('changeSP').disabled = true;
            var inputs = document.querySelectorAll('#boddydssp input');
            inputs.forEach(function (input) {
                input.disabled = true;

            });
            var button = document.querySelectorAll('#boddydssp button');
            button.forEach(function (btn) {
                btn.disabled = true;

            });
            var inputss = document.querySelectorAll('#boddydssp a');
            inputss.forEach(function (inp) {
                // Lưu giá trị href ban đầu vào thuộc tính data-href
                inp.setAttribute('data-href', inp.getAttribute('href'));
                // Xóa thuộc tính href
                inp.removeAttribute('href');

            });
            xacnhanthanhcongcf();
            // disabled hết các nút sau khi xác nhận


        }
        //xóa bản ghi phương thức thanh toán
        function xoaphuongthuc(url) {
            if (confirm('Bạn muốn loại bỏ bản giao dịch này?')) {
                document.getElementById('xacnhanthanhtoanhoadon').disabled = true;
                document.getElementById('chantrasau').disabled = false;
                document.getElementById('changeNV').disabled = false;
                document.getElementById('chonMaGiam').disabled = false;
                document.getElementById('start-scan').disabled = false;
                document.getElementById('themKHS').disabled = false;
                document.getElementById('changeSP').disabled = false;
                var inputs = document.querySelectorAll('#boddydssp input');
                inputs.forEach(function (input) {
                    input.disabled = false;

                });
                var button = document.querySelectorAll('#boddydssp button');
                button.forEach(function (btn) {
                    btn.disabled = false;

                });
                var inputss = document.querySelectorAll('#boddydssp a');
                inputss.forEach(function (inp) {
                    inp.setAttribute('href', inp.getAttribute('data-href'));
                    // Xóa thuộc tính data-href không cần thiết nữa
                    inp.removeAttribute('data-href');
                });
                fetch(url)
                    .then(function (a) {
                        return a.json();
                    })
                    .then(function (b) {
                        var htmlpt = '';
                        var checkchuyenkhoan = 0;
                        var checktienmat = 0;
                        if (b.length > 0) {
                            var stt = 0;
                            var tiendathanhtoan = 0;
                            for (const hd of b) {
                                if (hd.mota == 'tiền mặt') {
                                    checktienmat = 1;
                                }
                                if (hd.mota == 'chuyển khoản') {
                                    checkchuyenkhoan = 1;
                                }
                                tiendathanhtoan += hd.tongtien;
                                stt++;
                                htmlpt += ` <tr>
                                              <td>${stt}</td>
                                              <td>${hd.magiaodichvnpay == null ? '' : hd.magiaodichvnpay}</td>
                                              <td>${hd.tongtien}</td>
                                              <td>${hd.mota}</td>
                                              <td>
                                                <a onclick="xoaphuongthuc('http://localhost:8080/ban-hang-tai-quay/delete-pttt/${hd.tongtien}')"
                                                            >
                                                            <button class="btn btn-outline-danger"
                                                                
                                                                type="button"><i class="bi bi-trash3"></i></button></a>
                                              </td>
                                          </tr>`;
                            }
                            if (checkchuyenkhoan == 1) {
                                document.getElementById('chuyenkhoan').disabled = true;
                            } else {
                                document.getElementById('chuyenkhoan').disabled = false;
                            }
                            if (checktienmat == 1) {
                                document.getElementById('tienmat').disabled = true;
                            } else {
                                document.getElementById('tienmat').disabled = false;
                            }

                            document.getElementById('dathanhtoanroi').innerHTML = tiendathanhtoan;
                            document.getElementById('showpt').innerHTML = htmlpt;
                            var showTien = document.getElementById('sotienhienthi');
                            showTien.value = (tienkhachthanhtoan - tiendathanhtoan).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('tienthieu').innerHTML = (tienkhachthanhtoan - tiendathanhtoan).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('hdThanhToanShow').innerHTML = hdHienTai;
                            if (convertCurrency(document.getElementById('sotienhienthi').value) == 0) {
                                document.getElementById('xacnhanPT').disabled = false;
                            } else {
                                document.getElementById('xacnhanPT').disabled = true;
                            }

                        } else {

                            document.getElementById('chuyenkhoan').disabled = false;
                            document.getElementById('tienmat').disabled = false;
                            document.getElementById('showpt').innerHTML = htmlpt;
                            var showTien = document.getElementById('sotienhienthi');
                            showTien.value = tienkhachthanhtoan.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('tienthieu').innerHTML = tienkhachthanhtoan.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('hdThanhToanShow').innerHTML = hdHienTai;
                            document.getElementById('dathanhtoanroi').innerHTML = '0đ';
                            if (convertCurrency(document.getElementById('sotienhienthi').value) == 0) {
                                document.getElementById('xacnhanPT').disabled = false;
                            } else {
                                document.getElementById('xacnhanPT').disabled = true;
                            }
                        }

                    })
            }
        }

        //thông báo dùng chung
        //         "success": Biểu tượng thành công (dấu kiểm xanh).
        // "error": Biểu tượng lỗi (dấu chéo đỏ).
        // "warning": Biểu tượng cảnh báo (dấu chấm than vàng).
        // "info": Biểu tượng thông tin (chữ 'i' trong vòng tròn xanh).
        // "question": Biểu tượng câu hỏi (dấu chấm hỏi trong vòng tròn xanh).
        function thongbao(title, iconsz) {
            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                }
            });

            Toast.fire({
                icon: iconsz,
                title: title
            });
        }
        //chặn đường dẫn thẻ a
        function handleLinkClick() {
            document.getElementById('start-scan').disabled = false;
            document.getElementById('themKHS').disabled = false;
            document.getElementById('changeNV').disabled = false;
            document.getElementById('chonMaGiam').disabled = false;
            document.getElementById('changeSP').disabled = false;
            var checkgiaohang = document.getElementById('checktrasau');
            var actionGiao = document.getElementById('thongtingiaohangform');

            var checksubmit = validateForm();

            if (checkgiaohang.checked) {
                if (checksubmit === true) {
                    thongbao('Đặt đơn thành công', 'success');
                    //giao hàng submit
                    setTimeout(function () {
                        actionGiao.action = 'http://localhost:8080/ban-hang-tai-quay/xacnhanthanhtoan/2';
                        actionGiao.submit();
                    }, 1300);


                } else {
                    thongbao('Thông tin giao hàng còn thiếu hoặc có lỗi!', 'warning');
                }
            } else {
                //giao hàng submit
                thongbao('Đặt đơn thành công', 'success');
                setTimeout(function () {
                    actionGiao.action = 'http://localhost:8080/ban-hang-tai-quay/xacnhanthanhtoan/1';
                    actionGiao.submit();

                }, 1300);


            }


            // thongbao('Chưa xác nhận thông tin thanh toán!!!', 'warning');

        }

        function hoatoc(event) {
            // Lấy phần tử checkbox từ sự kiện
            // validateForm();
            var checkbox = event.target;
            // Kiểm tra trạng thái của checkbox
            if (checkbox.checked) {
                document.getElementById('phigiaohang').readOnly = false;
            } else {
                document.getElementById('phigiaohang').readOnly = true;
            }

        }
        //xác định nghiệp vụ trả sau trả trước
        function handleCheckboxChange(event) {
            // Lấy phần tử checkbox từ sự kiện
            // validateForm();
            var checkbox = event.target;
            // Kiểm tra trạng thái của checkbox
            if (checkbox.checked) {
                //hóa đơn lựa chọn trả sau_mở nút xác nhận thanh toán và không cần thanh toán trước
                document.getElementById('xacnhanthanhtoanhoadon').disabled = false;
                document.getElementById('chantrasau').disabled = true;
                document.getElementById('changeNV').disabled = true;
                document.getElementById('chonMaGiam').disabled = true;
                document.getElementById('start-scan').disabled = true;
                document.getElementById('themKHS').disabled = true;
                document.getElementById('changeSP').disabled = true;
                var inputs = document.querySelectorAll('#boddydssp input');
                inputs.forEach(function (input) {
                    input.disabled = true;

                });
                var button = document.querySelectorAll('#boddydssp button');
                button.forEach(function (btn) {
                    btn.disabled = true;

                });
                var inputss = document.querySelectorAll('#boddydssp a');
                inputss.forEach(function (inp) {
                    // Lưu giá trị href ban đầu vào thuộc tính data-href
                    inp.setAttribute('data-href', inp.getAttribute('href'));
                    // Xóa thuộc tính href
                    inp.removeAttribute('href');

                });

            } else {
                //hóa đơn lựa chọn trả trước đóng nút xác nhận thanh toán và yêu cầu thanh toán trước
                document.getElementById('xacnhanthanhtoanhoadon').disabled = true;
                document.getElementById('chantrasau').disabled = false;

                document.getElementById('changeNV').disabled = false;
                document.getElementById('chonMaGiam').disabled = false;
                document.getElementById('start-scan').disabled = false;
                document.getElementById('themKHS').disabled = false;
                document.getElementById('changeSP').disabled = false;
                var inputs = document.querySelectorAll('#boddydssp input');
                inputs.forEach(function (input) {
                    input.disabled = false;

                });
                var button = document.querySelectorAll('#boddydssp button');
                button.forEach(function (btn) {
                    btn.disabled = false;

                });
                var inputss = document.querySelectorAll('#boddydssp a');
                inputss.forEach(function (inp) {

                    // Lấy giá trị href từ thuộc tính data-href và gán lại cho thuộc tính href
                    inp.setAttribute('href', inp.getAttribute('data-href'));
                    // Xóa thuộc tính data-href không cần thiết nữa
                    inp.removeAttribute('data-href');

                });
            }
        }

        //http://localhost:8080/ban-hang-tai-quay/fillDiachi
        function showdiachimacdinh() {
            const urldcgiao = `http://localhost:8080/ban-hang-tai-quay/fillDiachi`;
            fetch(urldcgiao)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {

                    tentinhtam = b.tinh;
                    tenhuyentam = b.huyen;
                    tenxatam = b.xa;
                    document.getElementById('thongtingiao_ten').value = b.ten;
                    document.getElementById('thongtingiao_sdt').value = b.sdt;
                    document.getElementById('thongtingiao_email').value = b.email;
                    document.getElementById('thongtingiao_diachi').value = b.diachi;
                    document.getElementById('tinhthanh').value = b.tinh;

                    document.getElementById('quanhuyen').innerHTML = '';
                    var optionhuyen = document.createElement('option');
                    optionhuyen.value = b.huyen;
                    optionhuyen.textContent = b.huyen;
                    document.getElementById('quanhuyen').appendChild(optionhuyen);


                    document.getElementById('xaphuong').innerHTML = '';
                    var optionxa = document.createElement('option');
                    optionxa.value = b.xa;
                    optionxa.textContent = b.xa;
                    document.getElementById('xaphuong').appendChild(optionxa);


                    if (b.xa == null) {
                        var optionxaa = document.createElement('option');
                        optionxaa.value = 'chọn xã';
                        optionxaa.textContent = 'chọn xã';
                        optionxaa.selected = true;
                        document.getElementById('xaphuong').appendChild(optionxaa);
                    }
                    if (b.huyen == null) {
                        var optionhuyena = document.createElement('option');
                        optionhuyena.value = 'chọn huyện';
                        optionhuyena.textContent = 'chọn huyện';
                        optionhuyena.selected = true;
                        document.getElementById('quanhuyen').appendChild(optionhuyena);
                    }
                    if (b.tinh == null) {
                        document.getElementById('tinhthanh').value = 'chọn tỉnh';
                    }
                    callIdCity(b.tinh, b.huyen, b.xa)
                })
        }

        function formatCurrency(amount) {
            return amount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
        }
        function formatDate(date) {
            // Chuyển đổi tham số date thành đối tượng Date (nếu cần)
            const d = new Date(date);

            // Lấy ngày, tháng và năm
            const day = d.getDate();
            const month = d.getMonth() + 1; // Tháng trong JavaScript bắt đầu từ 0
            const year = d.getFullYear();

            // Định dạng thành dd/mm/yyyy
            const formattedDate = [
                day.toString().padStart(2, '0'), // Đảm bảo ngày có hai chữ số
                month.toString().padStart(2, '0'), // Đảm bảo tháng có hai chữ số
                year
            ].join('/');

            return formattedDate;
        }
        //http://localhost:8080/ban-hang-tai-quay/show-all-voucher
        function showmagiam() {
            const urlVoucher = `http://localhost:8080/ban-hang-tai-quay/show-all-voucher`;
            fetch(urlVoucher)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    if (b === false) {
                        document.getElementById('showvoucher').innerHTML = `<div class="tab-pane fade show active text-center fw-bold" id="tatCaHoaDon-tab-pane" role="tabpanel" aria-labelledby="tatCaHoaDon-tab" tabindex="0">
                                            <br>
                                            <img src="../dist/img/no_product.png" width="300px" height="300px">
                                            <h3 class="text text-danger"><i>Không tìm thấy voucher phù hợp!! <i class="bi bi-emoji-tear"></i>!</i></h3>
                                        </div>`;
                    } else {
                        if (b.length > 0) {
                            var htmlvoucher = '';
                            for (const hd of b) {
                                htmlvoucher += `
                        <div class="ma_giam_gia">
                                <div class="ma-item-left">
                                    <img class="anh_ma" src="../dist/img/anhgiamgia.webp">
                                </div>
                                <div class="ma-item-right">
                                    <h4 style="font-size: 14px; font-weight: 700; margin: 0; padding: 0;" >${hd.loaiphieu == true ? 'Giảm ' + hd.giatrigiam + ' %' + ', tối đa ' + formatCurrency(hd.giatrigiamtoida) : 'Giảm ' + formatCurrency(hd.giatrigiam)}
                                    </h4>
                                    
                                    <p style="font-size: 14px; margin: 0; padding: 0; color: black">${'Đơn hàng từ ' + formatCurrency(hd.dontoithieu) + ' trở lên'}
                                        </p>
                                    <div class="ma-item-des">
                                        <div class="left_magiam">
                                            <p style="margin: 0; white-space: nowrap;">Mã: <b
                                                    class="code">${hd.macode}</b></p>
                                            <p>${'HSD: ' + hd.ngayketthuc}</p>
                                        </div>
                                        <div class="right_magiam">
                                        <a onclick="apdungvoucher('http://localhost:8080/ban-hang-tai-quay/ap-dung-voucher/${hd.id}')" data-bs-dismiss="modal" >
                                            Áp dụng
                                                          </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                        `;
                            }
                            document.getElementById('showvoucher').innerHTML = htmlvoucher;
                            // 
                        } else {
                            document.getElementById('showvoucher').innerHTML = `<div class="tab-pane fade show active text-center fw-bold" id="tatCaHoaDon-tab-pane" role="tabpanel" aria-labelledby="tatCaHoaDon-tab" tabindex="0">
                                            <br>
                                            <img src="../dist/img/no_product.png" width="300px" height="300px">
                                            <h3 class="text text-danger"><i>Không tìm thấy voucher phù hợp!! <i class="bi bi-emoji-tear"></i>!</i></h3>
                                        </div>`;
                        }
                    }

                })
        }
        //sự kiện áp dụng mã giảm 
        function apdungvoucher(inputs) {
            var urlcheckapp = "http://localhost:8080/ban-hang-tai-quay/check-phieu/" + inputs.split('/').pop();
            fetch(urlcheckapp)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    if (tongTienDon >= b.dontoithieu) {
                        fetch(inputs)
                            .then(function (a) {
                                return a.json();
                            })
                            .then(function (b) {

                                if (b.id != null) {
                                    if (b.loaiphieu == true) {
                                        // phiếu %
                                        if (b.giatrigiam * (tongTienDon / 100) > b.giatrigiamtoida) {
                                            TienGiamDon = b.giatrigiamtoida;
                                        } else {
                                            TienGiamDon = b.giatrigiam * (tongTienDon / 100);
                                        }

                                    } else {
                                        // phiếu vnđ
                                        TienGiamDon = b.giatrigiam;
                                    }
                                    tienkhachthanhtoan = tongTienDon - TienGiamDon + shipToanCuc;
                                } else {
                                    tienkhachthanhtoan = tongTienDon + shipToanCuc;
                                }
                                // console.log("tiền tệ")
                                // console.log('tiền ban đầu:' + tongTienDon)
                                // console.log('tiền giảm :' + TienGiamDon)
                                // console.log('tiền tổng thanh toán:' + tienkhachthanhtoan)
                                thongbao('Áp dụng thành công', 'success')
                                document.getElementById('maGiamFill').innerHTML = b.macode;
                                document.getElementById('giamgia').innerHTML = TienGiamDon.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                                document.getElementById('tongThanhToan').innerHTML = (tienkhachthanhtoan - shipToanCuc).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });


                            })
                    } else {
                        thongbao('Hóa đơn chưa đạt đủ số tiền tối thiểu!', 'warning');
                    }

                })




        }
    </script>
    <!-- chạy lại cdn bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
        crossorigin="anonymous"></script>

    <!-- hienthibill -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        var checkdeleteHD = /*[[${checkdeleteHD}]]*/ false;
        /*]]>*/
        if (checkdeleteHD == true) {
            thongbao('Hóa đơn đã được xóa!', 'success');
        }
    </script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var checkChoseSp = /*[[${checkChoseSp}]]*/ false;
        var choseSPsucsess = /*[[${choseSPsucsess}]]*/ false;
        var choseUpdate = /*[[${choseUpdate}]]*/ false;
        var checkChoseKH = /*[[${checkChoseKH}]]*/ false;
        var checkaddKH = /*[[${checkaddKH}]]*/ false;
        var checkaddKHSucsses = /*[[${checkaddKHSucsses}]]*/ false;

        /*]]>*/
        if (checkChoseSp == true) {
            thongbao('Chưa có hóa đơn nào được chọn', 'warning')
        }
        if (choseUpdate == true) {
            thongbao('Sản phẩm đã tồn tại, số lượng sản phẩm đã tăng thêm 1', 'success')
        }
        if (choseSPsucsess == true) {
            thongbao('Thêm sản phẩm thành công', 'success')
        }
        if (checkChoseKH == true) {
            thongbao('Chưa có hóa đơn nào được chọn', 'warning')
        }
        if (checkaddKH == true) {
            thongbao('Chưa có hóa đơn nào được chọn', 'warning')
        }
        if (checkaddKHSucsses == true) {
            thongbao('Thêm khách hàng thành công', 'success')
        }

    </script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var orderSuccess = /*[[${orderSuccess}]]*/ false;
        var checkHangCho = /*[[${checkHangCho}]]*/ false;
        var checkdeleteHD = /*[[${checkdeleteHD}]]*/ false;
        /*]]>*/

        if (checkHangCho == true) {
            thongbao('Có 02 đơn hàng hàng chờ đã hiển thị', 'info')
        }
        if (orderSuccess === true) {
            var urlgetbill = `http://localhost:8080/ban-hang-tai-quay/show-bill`;
            fetch(urlgetbill)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    console.log(b)
                    var htmlbill1 = '';
                    var htmlbill2 = '';
                    var htmlbill3 = '';
                    if (b.tennguoinhan == null) {
                        htmlbill3 = `<h5 >Họ và tên: khách lẻ</h5>
                    <h5 >Số điện thoại: khách lẻ </h5>`;
                    } else {
                        htmlbill3 = `<h5 >${'Họ và tên: ' + b.tennguoinhan}</h5>
                    <h5 >${'Số điện thoại: ' + b.sdtnhan}</h5>`;

                    }

                    var stt = 0;
                    for (const hd of b.lst) {
                        stt++;
                        htmlbill1 += `
                                    <tr>
                                        <td >${stt}</td>
                                        <td >${hd.tensanpham}</td>
                                        <td >${'SL: ' + hd.soluong}</td>
                                    </tr>

                                   `;
                    }

                    htmlbill2 = `
                    <div class="d-flex justify-content-center">
                            <div class="ms-5">
                                <h1 style="font-size: 40px;" class="mt-5" >FSPORT SHOP</h1>
                            </div>
                        </div>
                        <div class="d-flex justify-content-center">
                            <h5 >103 Trịnh Văn Bô,Phương Canh, Nam Từ
                                Liêm,
                                Hà Nội</h5>
                        </div>
                        <div class="d-flex justify-content-center">
                            <p>SDT: 0379036606</p>
                        </div>
                        <div class="d-flex justify-content-center">
                            <h5>${'Mã hóa đơn: ' + b.ma}</h5>
                        </div>

                        <hr class="my-4">

                        <div class="row">

                            <div class="col">
                                <h3>Khách hàng:</h3>
                                `+
                        htmlbill3
                        + `
                            </div>
                        </div>
                        <hr class="my-4">
                        <div class="row">
                            <div class="col">
                                <h3>Nội dung đơn hàng(Tổng số lượng sản phẩm: ${b.lst.length})</h3>
                                <table class="table">


                    `+ htmlbill1 + `
                       </table>
                            </div>
                            <div class="col text-center mt-3">
                                <img src="data:image/png;base64,${b.qr}" alt="" style="height: 200px; width: 200px;"/>
                                 </div>
                        </div>
                        <hr class="my-4">
                        <div class="row">
                            <div class="col">
                                <h3>Tổng đơn</h3>
                                <h2>
                             ${formatCurrency(b.tongtien)}
                                </h2>
                            </div>
                            <div class="col text-end me-5">
                                <div style="border: 1px dotted black; padding: 5px; margin-left: 120px;">
                                    <p class="me-4" >${'Hà Nội, Ngày ' + formatDate(b.date)}</p>
                                    <h3 class="text-center mb-4">Người lập phiếu</h3>
                                    <p class="text-center">${b.nhanvien}</p>
                                </div>
                            </div>

                        </div>
                    `;
                    document.getElementById('hienthibill').innerHTML = htmlbill2;
                    var myModal = new bootstrap.Modal(document.getElementById('orderSuccessModal'), {});
                    myModal.show();
                    orderSuccess = null;
                })


        } else {
            if (orderSuccess === false) {
                thongbao('Có 01 đơn hàng giao mới', 'info')
            }
        }

    </script>

    <script>
        //chuyển tên city để so sánh
        function extractLocation(input) {
            // Chuyển chuỗi về dạng chữ thường để so sánh
            const lowerCaseInput = input.toLowerCase();

            // Kiểm tra và tách từ "tỉnh" hoặc "thành phố"
            if (lowerCaseInput.startsWith("tỉnh ")) {
                // Tách từ "tỉnh" và lấy phần còn lại
                const province = input.slice(5).trim();
                return { type: "tỉnh", name: province };
            } else if (lowerCaseInput.startsWith("thành phố ")) {
                // Tách từ "thành phố" và lấy phần còn lại
                const city = input.slice(10).trim();
                return { type: "thành phố", name: city };
            } else {
                return { type: "unknown", name: input.trim() };
            }
        }
        // <!-- //call api ngày giao dự kiến -->

        function callIdCity(thanhpho, huyen, xa) {
            var tencity = extractLocation(thanhpho);
            var tenhuyen = huyen;
            var tenxa = xa;

            var idCityreturn;
            var idHuyenreturn;
            var idXareturn;

            var Parameter = {
                url: "https://online-gateway.ghn.vn/shiip/public-api/master-data/province",
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Token": "59db4e6a-23e7-11ef-8c74-4ad7faca6bdc"
                }
            };
            axios(Parameter)
                .then(function (a) {
                    return a.data;
                })
                .then(function (b) {
                    // tách id thành phố
                    for (const id of b.data) {
                        if (id.ProvinceName.toLowerCase() === tencity.name.toLowerCase()) {
                            idCityreturn = id.ProvinceID;
                        }
                    }

                    var requestDataHuyen = {
                        province_id: idCityreturn
                    };

                    // Cấu hình yêu cầu với axios, bao gồm Token và dữ liệu gửi đi
                    var ParameterHuyen = {
                        url: "https://online-gateway.ghn.vn/shiip/public-api/master-data/district",
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Token": "59db4e6a-23e7-11ef-8c74-4ad7faca6bdc"
                        },
                        data: JSON.stringify(requestDataHuyen)
                    };

                    // Gửi yêu cầu và xử lý phản hồi
                    axios(ParameterHuyen)
                        .then(function (response) {
                            return response.data;
                        })
                        .then(function (d) {
                            //tách id huyện
                            for (const id of d.data) {
                                if (id.DistrictName.toLowerCase() === tenhuyen.toLowerCase()) {
                                    idHuyenreturn = id.DistrictID;
                                }
                            }
                            //tách id xã 
                            var requestData = {
                                district_id: idHuyenreturn
                            };

                            // Cấu hình yêu cầu với axios, bao gồm Token và dữ liệu gửi đi
                            var Parameter = {
                                url: "https://online-gateway.ghn.vn/shiip/public-api/master-data/ward?district_id",
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                    "Token": "59db4e6a-23e7-11ef-8c74-4ad7faca6bdc"
                                },
                                data: JSON.stringify(requestData)
                            };

                            // Gửi yêu cầu và xử lý phản hồi
                            axios(Parameter)
                                .then(function (response) {
                                    return response.data;
                                })
                                .then(function (d) {
                                    //tách id xã
                                    for (const id of d.data) {
                                        if (id.WardName.toLowerCase() === tenxa.toLowerCase()) {
                                            idXareturn = id.WardCode;
                                        }
                                    }
                                    var requestDataDate = {
                                        from_district_id: 3440,//địa chỉ mặc địch của shop
                                        from_ward_code: "13007",//địa chỉ mặc địch của shop
                                        to_district_id: idHuyenreturn,
                                        to_ward_code: idXareturn.toString(),
                                        service_id: 53320
                                    };
                                    // Cấu hình yêu cầu với axios, bao gồm Token và dữ liệu gửi đi
                                    var ParameterDate = {
                                        url: "https://online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/leadtime",
                                        method: "POST",
                                        headers: {
                                            "Content-Type": "application/json",
                                            "Token": "59db4e6a-23e7-11ef-8c74-4ad7faca6bdc",
                                            "ShopId": "5115739"
                                        },
                                        data: JSON.stringify(requestDataDate)
                                    };
                                    // Gửi yêu cầu và xử lý phản hồi
                                    axios(ParameterDate)
                                        .then(function (response) {
                                            return response.data; // In dữ liệu ra console
                                        })
                                        .then(function (d) {
                                            // Số nguyên đại diện cho một thời điểm trong JavaScript (ví dụ: số giây kể từ Epoch)
                                            var timestamp = d.data.leadtime;
                                            var date = new Date(timestamp * 1000);

                                            // Lấy ngày, tháng, năm từ đối tượng Date
                                            var day = date.getDate();
                                            var month = date.getMonth() + 1; // Tháng bắt đầu từ 0
                                            var year = date.getFullYear();

                                            // Đảm bảo định dạng dd và mm luôn có hai chữ số
                                            if (day < 10) {
                                                day = '0' + day;
                                            }
                                            if (month < 10) {
                                                month = '0' + month;
                                            }

                                            // Trả về chuỗi định dạng dd/mm/yyyy
                                            var days = day + '/' + month + '/' + year;

                                            document.getElementById('ngaygiaodukiens').innerHTML = days;
                                            document.getElementById('thongtingiao_ngaygiao').value = timestamp;

                                            // phigiaohang

                                            feship(idHuyenreturn, idXareturn);


                                        })
                                })


                        })
                })

        }

        function feship(idhuyen, idxa) {
            var requestData =
            {
                service_id: 53321,
                insurance_value: 500000,
                coupon: null,
                from_district_id: 3440,
                to_district_id: idhuyen,
                to_ward_code: idxa.toString(),
                height: 15,
                length: 15,
                weight: 1000,
                width: 15
            };
            // Cấu hình yêu cầu với axios, bao gồm Token và dữ liệu gửi đi
            var Parameter = {
                url: "https://online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/fee",
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Token": "59db4e6a-23e7-11ef-8c74-4ad7faca6bdc",
                    "ShopId": "5115739"
                },
                data: JSON.stringify(requestData)
            };

            // Gửi yêu cầu và xử lý phản hồi
            axios(Parameter)
                .then(function (response) {
                    return response.data // In dữ liệu ra console
                })
                .then(function (d) {
                    var shipluutam = shipToanCuc;
                    shipToanCuc = d.data.total;
                    if (tongTienDon >= 2000000) {
                        shipToanCuc = 0;
                    }
                    document.getElementById('phigiaohang').value = convertCashInput(shipToanCuc);
                    tienkhachthanhtoan = (tongTienDon - TienGiamDon) + shipToanCuc;
                })

        }
        function convertCashInput(amount) {
            // Chuyển số thành chuỗi và thêm dấu phân cách hàng nghìn
            let formattedAmount = amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            // Thêm ký hiệu tiền tệ ₫ vào cuối chuỗi
            return formattedAmount + " ₫";
        }

        function feanddate() {
            var tinhfeanddate = document.getElementById('tinhthanh').value;
            var huyenfeanddate = document.getElementById('quanhuyen').value;
            var xafeanddate = document.getElementById('xaphuong').value;
            callIdCity(tinhfeanddate, huyenfeanddate, xafeanddate);
            thongbao('thông tin vận chuyển đã có sự thay đổi', 'info')
        }

        function showHDtrangcho() {
            var urlShowTran = `http://localhost:8080/ban-hang-tai-quay/show-hang-cho`;
            fetch(urlShowTran)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var htmlHDHangChor = '';
                    var htmlHDHangChol = '';
                    for (const hd of b[1]) {
                        htmlHDHangChor += `
                        <div>
                                        <label for="name1">${'Hóa đơn: ' + hd.mahoadon}</label>
                                        <input type="radio"  name="rightbox" id="${hd.mahoadon}" onclick="checkRadioStatus()">
                                    </div>
                        `;
                    }
                    for (const md of b[0]) {
                        htmlHDHangChol += `
                        <div>
                                        <label for="name1">${'Hóa đơn: ' + md.mahoadon}</label>
                                        <input type="radio"  name="leftbox" id="${md.mahoadon}" onclick="checkRadioStatus()">
                                    </div>
                        `;
                    }

                    document.getElementById('name-checkbox-l').innerHTML = htmlHDHangChol;

                    document.getElementById('name-checkbox-r').innerHTML = htmlHDHangChor;

                    document.getElementById('btnChuyen').disabled = true;
                })

        }
        function checkRadioStatus() {
            // Lấy tất cả radio button trong các div
            var leftRadios = document.querySelectorAll('#name-checkbox-l input[type="radio"]');
            var rightRadios = document.querySelectorAll('#name-checkbox-r input[type="radio"]');

            // Kiểm tra xem có bao nhiêu radio button được chọn
            var leftChecked = Array.from(leftRadios).filter(radio => radio.checked).length;
            var rightChecked = Array.from(rightRadios).filter(radio => radio.checked).length;

            // Hiển thị hoặc ẩn button dựa trên số lượng radio button được chọn

            if (leftChecked >= 1 && rightChecked >= 1) {
                document.getElementById('btnChuyen').disabled = false;
            } else {
                document.getElementById('btnChuyen').disabled = true;
            }
        }

        function chuyendoiTranCho() {
            // Lấy tất cả radio button trong các div
            var leftRadios = document.querySelectorAll('#name-checkbox-l input[type="radio"]');
            var rightRadios = document.querySelectorAll('#name-checkbox-r input[type="radio"]');

            // Lấy ID của các radio button được chọn
            var selectedIds = [];
            leftRadios.forEach(radio => {
                if (radio.checked) {
                    selectedIds.push(radio.id);
                }
            });
            rightRadios.forEach(radio => {
                if (radio.checked) {
                    selectedIds.push(radio.id);
                }
            });
            var urlChuyendoi = `http://localhost:8080/ban-hang-tai-quay/chuyen-doi-don?lstData=${selectedIds}`;
            fetch(urlChuyendoi)
                .then(function (c) {
                    return c.json();
                })
                .then(function (b) {
                    if (b == true) {
                        localStorage.setItem('thongbao', 'true');
                        window.location.href = 'http://localhost:8080/hoa-don/ban-hang';
                    } else {
                        thongbao('Lỗi không xác định', 'warning')
                    }
                })

        }
        var message = localStorage.getItem('thongbao');
        if (message === 'true') {
            thongbao('Chuyển đổi thành công', 'success');
            // Xóa trạng thái thông báo sau khi hiển thị
            localStorage.removeItem('thongbao');
        }

        //in hd tại quầy
        function inbill() {
            var urlindon = `http://localhost:8080/ban-hang-tai-quay/in-don-tai-quay`;
            fetch(urlindon)
                .then(function (c) {
                    return c.json();
                })
                .then(function (b) {
                    if (b == true) {
                        thongbao('In hóa đơn thành công', 'success')
                    } else {
                        thongbao('Lỗi không xác định', 'warning')
                    }
                })
        }

        //validate div địa chỉ giao
        function validateForm() {
            // Lấy các giá trị từ các input
            var hoVaTen = document.getElementById("thongtingiao_ten").value.trim();
            var soDienThoai = document.getElementById("thongtingiao_sdt").value.trim();
            var email = document.getElementById("thongtingiao_email").value.trim();
            var diaChi = document.getElementById("thongtingiao_diachi").value.trim();
            var tinh = document.getElementById("tinhthanh").value;
            var huyen = document.getElementById("quanhuyen").value;
            var xa = document.getElementById("xaphuong").value;
            var tienShip = document.getElementById("phigiaohang").value.trim();
            // Biến để kiểm tra nếu có lỗi
            var error = false;



            // Kiểm tra họ và tên
            if (hoVaTen === "") {
                document.getElementById('regexTen').innerHTML = 'Họ tên không được trống!';
                error = true;
            } else {

                var regex = /^[a-zA-ZÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêìíòóôõùúăđĩũơƯăâêôơÁÀẢÃẠÁẦẪẨẬẮẰẲẴẶẸẺẼỀỀỂỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪỬỮỰỶỸýỳỷỹọỏọốồộổỗớờởỡợ\s]+$/;

                // Kiểm tra chiều dài và ký tự đặc biệt
                if (hoVaTen.length < 5 || hoVaTen.length > 20) {
                    document.getElementById('regexTen').innerHTML = 'Họ tên phải có từ 5 đến 20 ký tự!';
                    error = true;
                } else if (checkKhongPhaiChuCai(hoVaTen) == true) {
                    document.getElementById('regexTen').innerHTML = 'Họ tên không được chứa ký tự đặc biệt!';
                    error = true;
                } else {
                    document.getElementById('regexTen').innerHTML = '';
                }
            }

            // Kiểm tra số điện thoại
            if (soDienThoai === "") {
                // alert("Số điện thoại không được để trống");
                document.getElementById('regexsdt').innerHTML = 'Số điện thoại không được trống!';

                error = true;
            } else {
                // Kiểm tra định dạng email
                var sdtPattern = /^0\d{9}$/;
                if (!sdtPattern.test(soDienThoai)) {
                    // alert("Email không hợp lệ");
                    document.getElementById('regexsdt').innerHTML = 'Số điện thoại phải bắt đầu bằng 0, độ dài 10 số!';
                    error = true;
                } else {
                    document.getElementById('regexsdt').innerHTML = '';
                }
            }

            // Kiểm tra email
            if (email === "") {
                // alert("Email không được để trống");
                document.getElementById('regexemail').innerHTML = 'Email không được trống!';
                error = true;
            } else {
                // Kiểm tra định dạng email
                var emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9]+\.[a-zA-Z]{2,4}(?:\.[a-zA-Z]{2,4})?$/;
                if (!emailPattern.test(email)) {
                    // alert("Email không hợp lệ");
                    document.getElementById('regexemail').innerHTML = 'Email sai định dạng!';
                    error = true;
                } else {
                    if (email.length < 5 || email.length > 254) {
                        document.getElementById('regexemail').innerHTML = 'Email phải có độ dài từ 5-254 theo chuẩn RFC 5321';
                        error = true;
                    } else {
                        document.getElementById('regexemail').innerHTML = '';
                    }
                }
            }

            // Kiểm tra địa chỉ
            if (diaChi === "") {
                // alert("Địa chỉ không được để trống");
                document.getElementById('regexdiachi').innerHTML = 'Địa chỉ không được trống!';
                error = true;
            } else {
                if (diaChi.length < 1 || diaChi.length > 20) {
                    document.getElementById('regexdiachi').innerHTML = 'Địa chỉ phải đạt từ 1-20 kí tự!';
                    error = true;
                } else {
                    document.getElementById('regexdiachi').innerHTML = '';
                }
            }

            // Kiểm tra chọn tỉnh
            if (tinh === "chọn tỉnh") {
                // alert("Bạn phải chọn tỉnh");
                document.getElementById('regextinh').innerHTML = 'Chưa chọn tỉnh!';

                error = true;
            } else {
                document.getElementById('regextinh').innerHTML = '';
            }

            // Kiểm tra chọn huyện
            if (huyen === "chọn huyện" || huyen.length === 4) {
                // alert("Bạn phải chọn huyện");
                document.getElementById('regexhuyen').innerHTML = 'Chưa chọn huyện!';
                error = true;
            } else {
                document.getElementById('regexhuyen').innerHTML = '';
            }


            // Kiểm tra chọn xã
            if (xa === "chọn xã" || xa.length === 4) {
                // alert("Bạn phải chọn xã");
                document.getElementById('regexxa').innerHTML = 'Chưa chọn xã!';
                error = true;
            } else {
                document.getElementById('regexxa').innerHTML = '';
            }

            // Kiểm tra tiền ship
            if (tienShip === "") {
                // alert("Tiền ship không được để trống");
                document.getElementById('regexship').innerHTML = 'Chưa có tiền ship';
                error = true;
            } else {
                if (tienShip.trim() === "₫") {
                    // alert("Địa chỉ không được để trống");
                    document.getElementById('regexship').innerHTML = 'Nếu miễn ship hãy nhập 0.0 ₫!';
                    error = true;
                } else {
                    document.getElementById('regexship').innerHTML = '';
                }

            }

            // Nếu có lỗi, ngăn chặn form không submit
            if (error) {
                return false;
            }

            // Nếu không có lỗi, cho phép form submit
            return true;
        }

        //check tên kí tự đặc biệt
        function checkKhongPhaiChuCai(str) {
            // Biểu thức chính quy để kiểm tra bất kỳ ký tự nào không phải là chữ cái tiếng Việt có dấu hoặc chữ cái Latinh không dấu
            const regex = /[^a-zA-ZÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêìíòóôõùúăđĩũơƯĂẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼỀỀỂưăạảấầẩẫậắằẳẵặẹẻẽềềểỄỆỈỊỌỎỐỒỔỖỘỚờợứừửữựỳỵỷỹỪừựÙúỦửỤụỴỳỵỷỹẠ-ỹ\s]/;
            return regex.test(str);
        }

        //validate form thông tin thêm nhanh khách hàng
        function validateForms() {
            // Lấy các giá trị từ các input
            var hoVaTen = document.getElementById("TTTK_ten").value.trim();
            var soDienThoai = document.getElementById("TTTK_sdt").value.trim();
            var email = document.getElementById("TTTK_email").value.trim();
            var diaChi = document.getElementById("TTTK_diachi").value.trim();
            var tinh = document.getElementById("city").value;
            var huyen = document.getElementById("district").value;
            var xa = document.getElementById("ward").value;
            // Biến để kiểm tra nếu có lỗi
            var error = false;



            // Kiểm tra họ và tên
            if (hoVaTen === "") {
                document.getElementById('TTTK_ten_regex').innerHTML = 'Họ tên không được trống!';
                error = true;
            } else {

                var regex = /^[a-zA-ZÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêìíòóôõùúăđĩũơƯăâêôơÁÀẢÃẠÁẦẪẨẬẮẰẲẴẶẸẺẼỀỀỂỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪỬỮỰỶỸýỳỷỹọỏọốồộổỗớờởỡợ\s]+$/;

                // Kiểm tra chiều dài và ký tự đặc biệt
                if (hoVaTen.length < 5 || hoVaTen.length > 20) {
                    document.getElementById('TTTK_ten_regex').innerHTML = 'Họ tên phải có từ 5 đến 20 ký tự!';
                    error = true;
                } else if (checkKhongPhaiChuCai(hoVaTen) == true) {
                    document.getElementById('TTTK_ten_regex').innerHTML = 'Họ tên không được chứa ký tự đặc biệt!';
                    error = true;
                } else {
                    document.getElementById('TTTK_ten_regex').innerHTML = '';
                }
            }

            // Kiểm tra số điện thoại
            if (soDienThoai === "") {
                // alert("Số điện thoại không được để trống");
                document.getElementById('TTTK_sdt_regex').innerHTML = 'Số điện thoại không được trống!';

                error = true;
            } else {
                // Kiểm tra định dạng email
                var sdtPattern = /^0\d{9}$/;
                if (!sdtPattern.test(soDienThoai)) {
                    // alert("Email không hợp lệ");
                    document.getElementById('TTTK_sdt_regex').innerHTML = 'Số điện thoại phải bắt đầu bằng 0, độ dài 10 số!';
                    error = true;
                } else {
                    var urlchecksdt = `http://localhost:8080/ban-hang-tai-quay/checksdt?sdt=${soDienThoai}`;
                    fetch(urlchecksdt)
                        .then(function (a) {
                            return a.json();
                        })
                        .then(function (b) {
                            if (b === true) {
                                document.getElementById('TTTK_sdt_regex').innerHTML = 'Số điện thoại đã được sử dụng';
                                error = true;

                            } else {
                                document.getElementById('TTTK_sdt_regex').innerHTML = '';
                            }

                        })

                }
            }

            // Kiểm tra email
            if (email === "") {
                // alert("Email không được để trống");
                document.getElementById('TTTK_email_regex').innerHTML = 'Email không được trống!';
                error = true;
            } else {
                // Kiểm tra định dạng email
                var emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9]+\.[a-zA-Z]{2,4}(?:\.[a-zA-Z]{2,4})?$/;
                if (!emailPattern.test(email)) {
                    // alert("Email không hợp lệ");
                    document.getElementById('TTTK_email_regex').innerHTML = 'Email sai định dạng!';
                    error = true;
                } else {
                    var urlcheckemail = `http://localhost:8080/ban-hang-tai-quay/checkemail?email=${email}`;
                    fetch(urlcheckemail)
                        .then(function (a) {
                            return a.json();
                        })
                        .then(function (b) {
                            if (b === true) {
                                document.getElementById('TTTK_email_regex').innerHTML = 'Email đã được sử dụng';
                                error = true;

                            } else {
                                if (email.length < 5 || email.length > 254) {
                                    document.getElementById('TTTK_email_regex').innerHTML = 'Email phải có độ dài từ 5-254 theo chuẩn RFC 5321';
                                    error = true;
                                } else {
                                    document.getElementById('TTTK_email_regex').innerHTML = '';
                                }

                            }

                        })
                }
            }

            // Kiểm tra địa chỉ
            if (diaChi === "") {
                // alert("Địa chỉ không được để trống");
                document.getElementById('TTTK_diachi_regex').innerHTML = 'Địa chỉ không được trống!';
                error = true;
            } else {
                if (diaChi.length < 1 || diaChi.length > 20) {
                    document.getElementById('TTTK_diachi_regex').innerHTML = 'Địa chỉ phải đạt từ 1-20 kí tự!';
                    error = true;
                } else {
                    document.getElementById('TTTK_diachi_regex').innerHTML = '';
                }

            }

            // Kiểm tra chọn tỉnh
            if (tinh === "chọn tỉnh") {
                // alert("Bạn phải chọn tỉnh");
                document.getElementById('TTTK_city_regex').innerHTML = 'Chưa chọn tỉnh!';

                error = true;
            } else {
                document.getElementById('TTTK_city_regex').innerHTML = '';
            }

            // Kiểm tra chọn huyện
            if (huyen === "chọn huyện" || huyen.length === 4) {
                // alert("Bạn phải chọn huyện");
                document.getElementById('TTTK_district_regex').innerHTML = 'Chưa chọn huyện!';
                error = true;
            } else {
                document.getElementById('TTTK_district_regex').innerHTML = '';
            }


            // Kiểm tra chọn xã
            if (xa === "chọn xã" || xa.length === 4) {
                // alert("Bạn phải chọn xã");
                document.getElementById('TTTK_ward_regex').innerHTML = 'Chưa chọn xã!';
                error = true;
            } else {
                document.getElementById('TTTK_ward_regex').innerHTML = '';
            }

            // Nếu có lỗi, ngăn chặn form không submit
            if (error) {
                return false;
            }

            return true;
        }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.18.6/umd/index.min.js"></script>
    <script>
        window.addEventListener('load', function () {

            let selectedDeviceId;
            const codeReader = new ZXing.BrowserQRCodeReader();
            const resultElement = document.getElementById('result-content');
            const startScanButton = document.getElementById('start-scan');
            const modalElement = document.getElementById('qrModal');
            const modal = new bootstrap.Modal(modalElement);

            startScanButton.addEventListener('click', () => {
                modal.show();

                codeReader.getVideoInputDevices()
                    .then((videoInputDevices) => {
                        selectedDeviceId = videoInputDevices[0].deviceId;
                        codeReader.decodeFromVideoDevice(selectedDeviceId, 'video', (result, err) => {
                            if (result) {
                                var urlChuyendoi = `http://localhost:8080/ban-hang-tai-quay/checkSPQR?ma=${result.text}`;
                                fetch(urlChuyendoi)
                                    .then(function (c) {
                                        return c.json();
                                    })
                                    .then(function (b) {
                                        if (b == true) {
                                            var urf = "http://localhost:8080/ban-hang-tai-quay/ChoseSPQR/" + result.text;
                                            window.location.href = urf;
                                            // Stop the camera and hide the modal
                                            codeReader.reset();
                                            modal.hide();
                                            thongbao('Thêm thành công!', 'success')
                                        } else {
                                            codeReader.reset();
                                            modal.hide();
                                            thongbao('Sản phẩm này đã hết hàng!', 'warning')
                                        }
                                    })
                            }
                            if (err && !(err instanceof ZXing.NotFoundException)) {
                                console.error(err);
                            }
                        });
                    })
                    .catch((err) => {
                        console.error(err);
                    });
            });

            // Stop the camera when the modal is closed
            modalElement.addEventListener('hidden.bs.modal', () => {
                codeReader.reset();
            });

        });

        //chặn tất cả thẻ a khi bấm xác nhận thanh toán
    </script>

</body>

</html>